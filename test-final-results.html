<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .test-section {
            padding: 30px;
        }
        .partner-test {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .partner-test.ent-752810 { border-left-color: #28a745; }
        .partner-test.ent-190973 { border-left-color: #dc3545; }
        .partner-id {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }
        button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .results {
            background: #1e1e1e;
            color: #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .result-item {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .success { background: rgba(40, 167, 69, 0.2); color: #28a745; }
        .error { background: rgba(220, 53, 69, 0.2); color: #dc3545; }
        .warning { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .info { background: rgba(23, 162, 184, 0.2); color: #17a2b8; }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .stats-card {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‰ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h1>
            <p>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
        </div>
        
        <div class="test-section">
            <div style="text-align: center; margin-bottom: 30px;">
                <button onclick="testBothPartners()" id="test-all-btn">ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø±ÙŠÙƒÙŠÙ†</button>
                <button onclick="compareResults()" id="compare-btn">ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
                <button onclick="clearResults()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </div>
            
            <div class="comparison">
                <div class="partner-test ent-752810">
                    <div class="partner-id">ENT-752810</div>
                    <button onclick="testPartner('ENT-752810')" id="test-752810-btn">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ø£ÙˆÙ„</button>
                    <div class="results" id="results-752810"></div>
                </div>
                
                <div class="partner-test ent-190973">
                    <div class="partner-id">ENT-190973</div>
                    <button onclick="testPartner('ENT-190973')" id="test-190973-btn">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø±ÙŠÙƒ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
                    <div class="results" id="results-190973"></div>
                </div>
            </div>
            
            <div id="comparison-results" style="margin-top: 30px;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        function addResult(partnerId, message, type = 'info') {
            const resultsDiv = document.getElementById(`results-${partnerId.replace('-', '')}`);
            const div = document.createElement('div');
            div.className = `result-item ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                throw error;
            }
        }

        async function testPartner(partnerId) {
            addResult(partnerId, `ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø±ÙŠÙƒ ${partnerId}...`, 'info');
            const btn = document.getElementById(`test-${partnerId.replace('-', '')}-btn`);
            btn.disabled = true;
            
            try {
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                addResult(partnerId, 'ğŸ“Š Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...', 'info');
                const statsResponse = await apiCall(`/enterprise/${partnerId}/stats`);
                const stats = statsResponse.data;
                
                addResult(partnerId, `ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†: ${stats.totalFormations}`, 
                    stats.totalFormations > 0 ? 'success' : 'warning');
                addResult(partnerId, `ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${stats.totalProjects}`, 'info');
                addResult(partnerId, `ğŸ“ˆ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©: ${stats.upcomingEvents}`, 'info');
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†
                addResult(partnerId, 'ğŸ“š Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†...', 'info');
                const formationsResponse = await apiCall(`/enterprise/${partnerId}/formations`);
                const formations = formationsResponse.data;
                
                addResult(partnerId, `ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†: ${formations.length}`, 
                    formations.length > 0 ? 'success' : 'warning');
                
                if (formations.length > 0) {
                    formations.forEach((formation, index) => {
                        const isCorrectPartner = formation.partnerId === partnerId;
                        addResult(partnerId, 
                            `${index + 1}. ${formation.title} (Partner: ${formation.partnerId})`,
                            isCorrectPartner ? 'success' : 'error');
                    });
                } else {
                    addResult(partnerId, 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†', 'warning');
                }
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                addResult(partnerId, 'ğŸ—ï¸ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹...', 'info');
                const projectsResponse = await apiCall(`/enterprise/${partnerId}/projects`);
                addResult(partnerId, `ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${projectsResponse.data.length}`, 'info');
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                addResult(partnerId, 'ğŸ“… Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...', 'info');
                const eventsResponse = await apiCall(`/enterprise/${partnerId}/events`);
                addResult(partnerId, `ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: ${eventsResponse.data.length}`, 'info');
                
                addResult(partnerId, 'âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                return {
                    partnerId,
                    stats,
                    formations,
                    projects: projectsResponse.data,
                    events: eventsResponse.data
                };
                
            } catch (error) {
                addResult(partnerId, `âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                return null;
            } finally {
                btn.disabled = false;
            }
        }

        async function testBothPartners() {
            const btn = document.getElementById('test-all-btn');
            btn.disabled = true;
            
            try {
                const results = await Promise.all([
                    testPartner('ENT-752810'),
                    testPartner('ENT-190973')
                ]);
                
                // Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                setTimeout(() => {
                    compareResults(results);
                }, 1000);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„:', error);
            } finally {
                btn.disabled = false;
            }
        }

        function compareResults(results = null) {
            const comparisonDiv = document.getElementById('comparison-results');
            
            if (!results) {
                comparisonDiv.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 20px;">
                        <h3>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
                        <p>Ø§Ø¶ØºØ· "Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø±ÙŠÙƒÙŠÙ†" Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</p>
                    </div>
                `;
                return;
            }
            
            const [result1, result2] = results;
            
            if (!result1 || !result2) {
                comparisonDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 1px solid #dc3545; border-radius: 8px; padding: 20px;">
                        <h3>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h3>
                        <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ ØµØ­ÙŠØ­Ø© Ù…Ù† Ø£Ø­Ø¯ Ø§Ù„Ø´Ø±ÙŠÙƒÙŠÙ†</p>
                    </div>
                `;
                return;
            }
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const isolation = {
                perfect: true,
                issues: []
            };
            
            // ÙØ­Øµ Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
            const formations1 = result1.formations.map(f => f.formationId);
            const formations2 = result2.formations.map(f => f.formationId);
            const sharedFormations = formations1.filter(id => formations2.includes(id));
            
            if (sharedFormations.length > 0) {
                isolation.perfect = false;
                isolation.issues.push(`${sharedFormations.length} ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ù…Ø´ØªØ±ÙƒØ©`);
            }
            
            // ÙØ­Øµ partnerId ØµØ­ÙŠØ­
            const wrongPartner1 = result1.formations.filter(f => f.partnerId !== result1.partnerId);
            const wrongPartner2 = result2.formations.filter(f => f.partnerId !== result2.partnerId);
            
            if (wrongPartner1.length > 0 || wrongPartner2.length > 0) {
                isolation.perfect = false;
                isolation.issues.push('ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ø¨Ù€ partnerId Ø®Ø§Ø·Ø¦');
            }
            
            const comparisonHtml = `
                <div style="background: ${isolation.perfect ? '#d4edda' : '#f8d7da'}; 
                           border: 1px solid ${isolation.perfect ? '#28a745' : '#dc3545'}; 
                           border-radius: 8px; padding: 20px;">
                    <h3>${isolation.perfect ? 'âœ…' : 'âŒ'} Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div>
                            <h4>ENT-752810</h4>
                            <p>Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†: ${result1.formations.length}</p>
                            <p>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${result1.projects.length}</p>
                            <p>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: ${result1.events.length}</p>
                            <p>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${result1.stats.totalFormations} ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†</p>
                        </div>
                        <div>
                            <h4>ENT-190973</h4>
                            <p>Ø§Ù„ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†: ${result2.formations.length}</p>
                            <p>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹: ${result2.projects.length}</p>
                            <p>Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: ${result2.events.length}</p>
                            <p>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${result2.stats.totalFormations} ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ†</p>
                        </div>
                    </div>
                    
                    ${isolation.perfect ? 
                        '<p><strong>ğŸ‰ Ø¹Ø²Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ!</strong></p>' :
                        `<p><strong>âš ï¸ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø¹Ø²Ù„:</strong> ${isolation.issues.join(', ')}</p>`
                    }
                    
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.1); border-radius: 5px;">
                        <h4>ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h4>
                        <ul>
                            <li>ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ù…Ø´ØªØ±ÙƒØ©: ${sharedFormations.length}</li>
                            <li>ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ø¨Ù€ partnerId Ø®Ø§Ø·Ø¦: ${wrongPartner1.length + wrongPartner2.length}</li>
                            <li>ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${result1.stats.totalFormations === result1.formations.length && result2.stats.totalFormations === result2.formations.length ? 'Ù†Ø¹Ù… âœ…' : 'Ù„Ø§ âŒ'}</li>
                        </ul>
                    </div>
                </div>
            `;
            
            comparisonDiv.innerHTML = comparisonHtml;
        }

        function clearResults() {
            document.getElementById('results-752810').innerHTML = '';
            document.getElementById('results-190973').innerHTML = '';
            document.getElementById('comparison-results').innerHTML = '';
        }

        // ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        window.onload = function() {
            document.getElementById('comparison-results').innerHTML = `
                <div style="background: #d1ecf1; border: 1px solid #17a2b8; border-radius: 8px; padding: 20px; text-align: center;">
                    <h3>ğŸš€ Ø£Ø¯Ø§Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
                    <p>Ø§Ø¶ØºØ· "Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù„Ø´Ø±ÙŠÙƒÙŠÙ†" Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</p>
                    <p><strong>Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ÙƒÙ„ Ø´Ø±ÙŠÙƒ ÙŠØ±Ù‰ ÙÙˆØ±Ù…Ø§Ø³ÙŠÙˆÙ† Ù…Ø®ØªÙ„ÙØ© Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØµØ­ÙŠØ­Ø©</p>
                </div>
            `;
        };
    </script>
</body>
</html>
