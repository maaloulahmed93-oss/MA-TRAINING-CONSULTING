<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Fix Conditions - MATC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background: #dc2626;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
        }
        .button:hover { background: #b91c1c; }
        .button.success { background: #059669; }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        
        .step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° Force Fix Conditions</h1>
        <p><strong>Correction forc√©e du probl√®me des Conditions requises</strong></p>

        <div class="step">
            <h3>üéØ Plan d'action:</h3>
            <ol>
                <li>Supprimer toutes les partnerships existantes</li>
                <li>Recr√©er avec des conditions compl√®tes</li>
                <li>Forcer la synchronisation</li>
                <li>V√©rifier le r√©sultat</li>
            </ol>
        </div>

        <button class="button" onclick="executeFullFix()">üöÄ EX√âCUTER CORRECTION COMPL√àTE</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';

        function updateStatus(message, type = 'success') {
            const resultsDiv = document.getElementById('results');
            let statusClass = type;
            resultsDiv.innerHTML += `<div class="status ${statusClass}">${message}</div>`;
        }

        async function executeFullFix() {
            updateStatus('üöÄ D√âBUT DE LA CORRECTION FORC√âE...', 'warning');
            
            try {
                // √âtape 1: Supprimer toutes les partnerships
                updateStatus('1Ô∏è‚É£ Suppression de toutes les partnerships...');
                const deleteResponse = await fetch(`${API_BASE}/partnerships`, {
                    method: 'DELETE'
                });
                
                if (deleteResponse.ok) {
                    updateStatus('‚úÖ Toutes les partnerships supprim√©es');
                } else {
                    updateStatus('‚ö†Ô∏è Suppression partielle', 'warning');
                }

                // √âtape 2: Recr√©er avec donn√©es compl√®tes
                updateStatus('2Ô∏è‚É£ Cr√©ation des partnerships avec conditions compl√®tes...');
                
                const partnerships = [
                    {
                        partnershipId: 'PART-FORMATEUR-FIXED',
                        type: 'formateur',
                        title: 'Formateur',
                        subtitle: 'Rejoignez notre √©quipe de formateurs experts',
                        intro: 'Rejoignez notre √©quipe de formateurs experts et partagez vos connaissances.',
                        icon: 'üìò',
                        color: 'blue',
                        gradient: 'from-blue-500 to-blue-600',
                        details: [
                            'Encadrer des sessions en pr√©sentiel et √† distance',
                            'Concevoir des supports p√©dagogiques de qualit√©',
                            '√âvaluer et suivre la progression des apprenants'
                        ],
                        requirements: [
                            'Minimum 3 ans d\'exp√©rience dans votre domaine',
                            'Dipl√¥me ou certifications reconnues',
                            'Excellentes comp√©tences p√©dagogiques',
                            'Disponibilit√© flexible pour les formations',
                            'Ma√Ætrise des outils num√©riques'
                        ],
                        ctaLabel: 'Acc√©der √† l\'Espace Formateur',
                        isActive: true
                    },
                    {
                        partnershipId: 'PART-FREELANCE-FIXED',
                        type: 'freelance',
                        title: 'Freelance',
                        subtitle: 'Collaborez avec nous en tant que freelance',
                        intro: 'Collaborez avec nous pour des missions ponctuelles ou r√©currentes.',
                        icon: 'üíª',
                        color: 'green',
                        gradient: 'from-green-500 to-green-600',
                        details: [
                            'Missions adapt√©es √† votre expertise',
                            'Collaboration flexible et agile',
                            'Facturation simple et transparente'
                        ],
                        requirements: [
                            'Portfolio d√©montrant vos comp√©tences',
                            'Exp√©rience en freelancing ou projets ind√©pendants',
                            'Capacit√© √† respecter les d√©lais',
                            'Communication professionnelle',
                            'Sp√©cialisation dans un domaine technique'
                        ],
                        ctaLabel: 'Acc√©der √† l\'Espace Freelancer',
                        isActive: true
                    },
                    {
                        partnershipId: 'PART-COMMERCIAL-FIXED',
                        type: 'commercial',
                        title: 'Commercial / Affili√©',
                        subtitle: 'Devenez notre partenaire commercial',
                        intro: 'Devenez notre partenaire commercial et b√©n√©ficiez de commissions attractives.',
                        icon: 'üìà',
                        color: 'orange',
                        gradient: 'from-orange-500 to-orange-600',
                        details: [
                            'Programme de commissions motivant',
                            'Outils marketing fournis',
                            'Suivi et reporting d√©di√©s'
                        ],
                        requirements: [
                            'Exp√©rience en vente ou marketing',
                            'R√©seau professionnel d√©velopp√©',
                            'Comp√©tences en n√©gociation',
                            'Motivation et esprit entrepreneurial',
                            'Connaissance du secteur de la formation'
                        ],
                        ctaLabel: 'Acc√©der √† l\'Espace Commercial',
                        isActive: true
                    },
                    {
                        partnershipId: 'PART-ENTREPRISE-FIXED',
                        type: 'entreprise',
                        title: 'Entreprise / √âcole',
                        subtitle: '√âtablissez un partenariat institutionnel',
                        intro: '√âtablissez un partenariat pour des formations sur mesure.',
                        icon: 'üè¢',
                        color: 'purple',
                        gradient: 'from-purple-500 to-purple-600',
                        details: [
                            'Programmes adapt√©s aux objectifs',
                            'Accompagnement et suivi personnalis√©s',
                            'Modalit√©s intra/inter-entreprise'
                        ],
                        requirements: [
                            'Entreprise ou institution √©ducative √©tablie',
                            'Besoin r√©current en formation',
                            'Capacit√© de collaboration √† long terme',
                            'Budget d√©di√© √† la formation',
                            'Engagement dans le d√©veloppement des comp√©tences'
                        ],
                        ctaLabel: 'Acc√©der √† l\'Espace Partenariat',
                        isActive: true
                    }
                ];

                // Cr√©er chaque partnership individuellement
                for (const partnership of partnerships) {
                    try {
                        const response = await fetch(`${API_BASE}/partnerships`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(partnership)
                        });

                        if (response.ok) {
                            updateStatus(`‚úÖ ${partnership.title}: Cr√©√© avec ${partnership.requirements.length} conditions`);
                        } else {
                            // Essayer avec PUT si POST √©choue
                            const putResponse = await fetch(`${API_BASE}/partnerships/${partnership.type}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(partnership)
                            });
                            
                            if (putResponse.ok) {
                                updateStatus(`‚úÖ ${partnership.title}: Mis √† jour avec ${partnership.requirements.length} conditions`);
                            } else {
                                updateStatus(`‚ùå ${partnership.title}: √âchec cr√©ation`, 'error');
                            }
                        }
                    } catch (error) {
                        updateStatus(`‚ùå ${partnership.title}: ${error.message}`, 'error');
                    }
                    
                    // Petit d√©lai entre les cr√©ations
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                // √âtape 3: V√©rification finale
                updateStatus('3Ô∏è‚É£ V√©rification finale...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const verifyResponse = await fetch(`${API_BASE}/partnerships`);
                if (verifyResponse.ok) {
                    const data = await verifyResponse.json();
                    updateStatus(`‚úÖ V√©rification: ${data.count} partnerships cr√©√©es`);
                    
                    let allHaveRequirements = true;
                    data.data.forEach(p => {
                        const reqCount = p.requirements?.length || 0;
                        if (reqCount > 0) {
                            updateStatus(`‚úÖ ${p.title}: ${reqCount} conditions`);
                        } else {
                            updateStatus(`‚ùå ${p.title}: Aucune condition`, 'error');
                            allHaveRequirements = false;
                        }
                    });
                    
                    if (allHaveRequirements) {
                        updateStatus('üéâ CORRECTION R√âUSSIE! Toutes les partnerships ont des conditions!', 'success');
                        updateStatus('üåê Rechargez le site maintenant - les conditions devraient appara√Ætre!', 'success');
                    } else {
                        updateStatus('‚ö†Ô∏è Certaines partnerships n\'ont toujours pas de conditions', 'warning');
                    }
                }

            } catch (error) {
                updateStatus(`‚ùå ERREUR CRITIQUE: ${error.message}`, 'error');
                updateStatus('üí° V√©rifiez que le Backend est d√©marr√© sur port 3001', 'warning');
            }
        }

        // Auto-message
        window.onload = function() {
            updateStatus('‚ö° Correction forc√©e pr√™te');
            updateStatus('‚ö†Ô∏è Cette op√©ration va recr√©er toutes les partnerships avec des conditions compl√®tes', 'warning');
            updateStatus('üéØ Cliquez sur le bouton rouge pour commencer', 'warning');
        };
    </script>
</body>
</html>
