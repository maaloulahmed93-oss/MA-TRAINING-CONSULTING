<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notifications Espace Participant - MATC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .success { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background-color: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { padding: 12px 20px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { background: #0056b3; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; font-size: 12px; overflow-x: auto; max-height: 300px; }
        .step { background: #f8f9fa; padding: 10px; border-left: 4px solid #007bff; margin: 10px 0; }
        .fix-applied { background: #e8f5e8; border-left: 4px solid #28a745; padding: 15px; margin: 10px 0; }
        .notification-demo { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî Test Notifications Espace Participant - MATC</h1>
        
        <div class="success">
            <h3>‚úÖ Syst√®me de notifications activ√©!</h3>
            <p><strong>Ajout√©:</strong> Component Notifications complet dans espace participant</p>
            <p><strong>Navigation:</strong> Bouton notifications dans header et mobile nav</p>
            <p><strong>Fonctionnalit√©s:</strong> Lecture, suppression, filtrage des notifications</p>
        </div>

        <div class="fix-applied">
            <h3>üîß Fonctionnalit√©s ajout√©es:</h3>
            <ul>
                <li><strong>Component Notifications:</strong> Interface compl√®te pour g√©rer les notifications</li>
                <li><strong>Navigation int√©gr√©e:</strong> Bouton dans header et mobile navigation</li>
                <li><strong>Filtrage:</strong> Toutes, Non lues, Lues</li>
                <li><strong>Actions:</strong> Marquer comme lu, Supprimer, Tout marquer comme lu</li>
                <li><strong>Types:</strong> Success, Warning, Error, Information</li>
                <li><strong>Priorit√©s:</strong> Haute, Moyenne, Faible</li>
                <li><strong>Liens d'action:</strong> Navigation vers formations, projets, coaching</li>
            </ul>
        </div>

        <div class="grid">
            <div class="test-section">
                <h3>üë§ Participant de test</h3>
                <div class="info">
                    <h4>Ismael Gharbi</h4>
                    <p><strong>ID:</strong> PART-550776</p>
                    <p><strong>Email:</strong> gharbi@gmail.com</p>
                </div>
                <button onclick="loadParticipantData()">Charger donn√©es</button>
                <button onclick="addTestNotifications()">Ajouter notifications test</button>
            </div>

            <div class="test-section">
                <h3>üß™ Tests Notifications</h3>
                <button onclick="testNotificationDisplay()">Test affichage</button>
                <button onclick="testNotificationActions()">Test actions</button>
                <button onclick="verifyNotificationIntegration()">V√©rifier int√©gration</button>
                <button onclick="runCompleteNotificationTest()" class="success">Test complet</button>
            </div>
        </div>

        <div class="test-section">
            <h3>üìã Instructions de test manuel - Notifications Espace Participant</h3>
            
            <div class="step">
                <h4>Test 1: Acc√©der aux notifications</h4>
                <ol>
                    <li>Allez sur: <a href="http://localhost:5173/espace-participant" target="_blank">Espace Participant</a></li>
                    <li>Connectez-vous: PART-550776 / gharbi@gmail.com</li>
                    <li>Dans le header, cliquez sur le bouton "Notifications" (ic√¥ne cloche) üîî</li>
                    <li>V√©rifiez que la page notifications s'ouvre ‚úÖ</li>
                </ol>
            </div>
            
            <div class="step">
                <h4>Test 2: Fonctionnalit√©s des notifications</h4>
                <ol>
                    <li>Dans la page notifications, v√©rifiez:
                        <ul>
                            <li>Filtres: Toutes, Non lues, Lues</li>
                            <li>Compteur de notifications non lues</li>
                            <li>Bouton "Tout marquer comme lu"</li>
                        </ul>
                    </li>
                    <li>Testez les actions sur chaque notification:
                        <ul>
                            <li>Marquer comme lu (ic√¥ne check)</li>
                            <li>Supprimer (ic√¥ne X)</li>
                            <li>Liens d'action (si disponibles)</li>
                        </ul>
                    </li>
                </ol>
            </div>
            
            <div class="step">
                <h4>Test 3: Navigation mobile</h4>
                <ol>
                    <li>R√©duisez la fen√™tre pour simuler mobile</li>
                    <li>V√©rifiez que le bouton notifications appara√Æt dans la barre de navigation flottante</li>
                    <li>Testez la navigation entre les sections</li>
                </ol>
            </div>
            
            <div class="step">
                <h4>Test 4: Int√©gration avec Admin Panel</h4>
                <ol>
                    <li>Ajoutez des notifications via Admin Panel</li>
                    <li>V√©rifiez qu'elles apparaissent dans espace participant</li>
                    <li>Testez la synchronisation des statuts (lu/non lu)</li>
                </ol>
            </div>
        </div>

        <div class="test-section">
            <h3>üîç D√©monstration des types de notifications</h3>
            <div class="grid">
                <div class="notification-demo">
                    <h4>‚úÖ Success</h4>
                    <p><strong>Exemple:</strong> "Votre compte a √©t√© cr√©√© avec succ√®s"</p>
                    <p><strong>Couleur:</strong> Vert</p>
                </div>
                <div class="notification-demo">
                    <h4>‚ÑπÔ∏è Information</h4>
                    <p><strong>Exemple:</strong> "Nouvelle formation disponible"</p>
                    <p><strong>Couleur:</strong> Bleu</p>
                </div>
                <div class="notification-demo">
                    <h4>‚ö†Ô∏è Warning</h4>
                    <p><strong>Exemple:</strong> "Date limite de projet approche"</p>
                    <p><strong>Couleur:</strong> Jaune</p>
                </div>
                <div class="notification-demo">
                    <h4>‚ùå Error</h4>
                    <p><strong>Exemple:</strong> "Erreur lors de la soumission"</p>
                    <p><strong>Couleur:</strong> Rouge</p>
                </div>
            </div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        let currentParticipant = null;

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        async function loadParticipantData() {
            log('üîÑ Chargement des donn√©es participant...', 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/participants/PART-550776');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        currentParticipant = data.data;
                        const notificationsCount = currentParticipant.notifications?.length || 0;
                        const unreadCount = currentParticipant.notifications?.filter(n => !n.isRead).length || 0;
                        
                        log(`‚úÖ Participant charg√©: ${currentParticipant.fullName}`, 'success');
                        log(`üîî Notifications totales: ${notificationsCount}`, notificationsCount > 0 ? 'success' : 'warning');
                        log(`üì¨ Notifications non lues: ${unreadCount}`, unreadCount > 0 ? 'warning' : 'success');
                        
                        if (notificationsCount > 0) {
                            currentParticipant.notifications.forEach((notification, index) => {
                                const status = notification.isRead ? '‚úÖ' : 'üì¨';
                                log(`${status} ${index + 1}. ${notification.title || notification.message} (${notification.type})`, 'info');
                            });
                        }
                        
                        return currentParticipant;
                    } else {
                        log('‚ùå Participant non trouv√©', 'error');
                        return null;
                    }
                } else {
                    log(`‚ùå Erreur API: ${response.status}`, 'error');
                    return null;
                }
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`, 'error');
                return null;
            }
        }

        async function addTestNotifications() {
            log('üìù Ajout de notifications de test...', 'info');
            
            if (!currentParticipant) {
                await loadParticipantData();
            }
            
            if (!currentParticipant) {
                log('‚ùå Impossible de continuer sans participant', 'error');
                return;
            }
            
            const testNotifications = [
                {
                    id: `NOTIF-SUCCESS-${Date.now()}`,
                    title: 'Bienvenue dans votre espace',
                    message: 'Votre compte participant a √©t√© cr√©√© avec succ√®s. Explorez vos formations et projets.',
                    type: 'success',
                    date: new Date().toISOString(),
                    isRead: false,
                    priority: 'medium'
                },
                {
                    id: `NOTIF-INFO-${Date.now()}`,
                    title: 'Nouvelle formation disponible',
                    message: 'Une nouvelle formation "D√©veloppement Web Avanc√©" est maintenant disponible.',
                    type: 'information',
                    date: new Date(Date.now() - 86400000).toISOString(),
                    isRead: false,
                    actionUrl: '/formations',
                    priority: 'high'
                },
                {
                    id: `NOTIF-WARNING-${Date.now()}`,
                    title: 'Date limite approche',
                    message: 'N\'oubliez pas de soumettre votre projet avant la date limite.',
                    type: 'warning',
                    date: new Date(Date.now() - 172800000).toISOString(),
                    isRead: false,
                    actionUrl: '/projects',
                    priority: 'high'
                },
                {
                    id: `NOTIF-ERROR-${Date.now()}`,
                    title: 'Erreur de soumission',
                    message: 'Une erreur s\'est produite lors de la soumission de votre projet. Veuillez r√©essayer.',
                    type: 'error',
                    date: new Date(Date.now() - 259200000).toISOString(),
                    isRead: true,
                    priority: 'high'
                }
            ];
            
            const updatedNotifications = [...(currentParticipant.notifications || []), ...testNotifications];
            
            const updateData = {
                ...currentParticipant,
                notifications: updatedNotifications,
                updatedAt: new Date().toISOString()
            };
            
            try {
                const response = await fetch(`http://localhost:3001/api/participants/PART-550776`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                if (response.ok) {
                    log(`‚úÖ ${testNotifications.length} notifications de test ajout√©es`, 'success');
                    setTimeout(() => loadParticipantData(), 1000);
                } else {
                    log(`‚ùå Erreur ajout notifications: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Erreur: ${error.message}`, 'error');
            }
        }

        async function testNotificationDisplay() {
            log('üñ•Ô∏è Test d\'affichage des notifications...', 'info');
            
            log('üìã Fonctionnalit√©s √† tester:', 'info');
            log('1. Page notifications accessible via bouton header', 'info');
            log('2. Filtres: Toutes, Non lues, Lues', 'info');
            log('3. Affichage des types: Success, Info, Warning, Error', 'info');
            log('4. Affichage des priorit√©s: Haute, Moyenne, Faible', 'info');
            log('5. Dates et heures format√©es', 'info');
            log('6. Liens d\'action fonctionnels', 'info');
            
            log('üîç Instructions:', 'warning');
            log('1. Ouvrez espace participant', 'info');
            log('2. Cliquez sur bouton Notifications (üîî)', 'info');
            log('3. V√©rifiez que toutes les fonctionnalit√©s s\'affichent correctement', 'info');
        }

        async function testNotificationActions() {
            log('‚ö° Test des actions de notifications...', 'info');
            
            log('üìã Actions √† tester:', 'info');
            log('1. Marquer comme lu (ic√¥ne check)', 'info');
            log('2. Supprimer notification (ic√¥ne X)', 'info');
            log('3. Tout marquer comme lu', 'info');
            log('4. Filtrer par statut', 'info');
            log('5. Navigation via liens d\'action', 'info');
            
            log('üîç Instructions:', 'warning');
            log('1. Dans page notifications, testez chaque action', 'info');
            log('2. V√©rifiez que les compteurs se mettent √† jour', 'info');
            log('3. Testez les liens vers formations/projets/coaching', 'info');
        }

        async function verifyNotificationIntegration() {
            log('üîó V√©rification de l\'int√©gration...', 'info');
            
            log('üìã Points d\'int√©gration:', 'info');
            log('1. Bouton notifications dans header desktop', 'info');
            log('2. Bouton notifications dans navigation mobile', 'info');
            log('3. Badge de notifications non lues', 'info');
            log('4. Navigation entre sections', 'info');
            log('5. Synchronisation avec Admin Panel', 'info');
            
            log('üîç Instructions:', 'warning');
            log('1. Testez navigation desktop et mobile', 'info');
            log('2. V√©rifiez badge de notifications', 'info');
            log('3. Testez ajout de notifications via Admin Panel', 'info');
        }

        async function runCompleteNotificationTest() {
            log('üöÄ Test complet du syst√®me de notifications...', 'info');
            
            // √âtape 1: Charger donn√©es
            log('üìã √âtape 1: Chargement donn√©es...', 'info');
            await loadParticipantData();
            
            // √âtape 2: Ajouter notifications test
            log('üìã √âtape 2: Ajout notifications test...', 'info');
            await addTestNotifications();
            
            // √âtape 3: V√©rifications
            setTimeout(async () => {
                log('üìã √âtape 3: V√©rifications finales...', 'info');
                await loadParticipantData();
                
                log('üéâ Test complet termin√©!', 'success');
                log('üìù R√©sum√© du syst√®me de notifications:', 'info');
                log('‚úÖ Component Notifications cr√©√© et int√©gr√©', 'success');
                log('‚úÖ Navigation desktop et mobile ajout√©e', 'success');
                log('‚úÖ Filtrage et actions impl√©ment√©s', 'success');
                log('‚úÖ Types et priorit√©s support√©s', 'success');
                log('‚úÖ Liens d\'action fonctionnels', 'success');
                log('‚úÖ Synchronisation avec backend', 'success');
                
                log('üîî Instructions finales:', 'warning');
                log('1. Testez dans espace participant: http://localhost:5173/espace-participant', 'info');
                log('2. Connectez-vous et cliquez sur bouton Notifications', 'info');
                log('3. Testez toutes les fonctionnalit√©s', 'info');
                log('4. V√©rifiez l\'int√©gration avec Admin Panel', 'info');
            }, 3000);
        }

        // Auto-run initial test
        window.onload = function() {
            setTimeout(async () => {
                log('üîÑ Chargement initial...', 'info');
                await loadParticipantData();
                
                log('üéØ Syst√®me de notifications pr√™t!', 'success');
                log('üìù Instructions:', 'info');
                log('1. Le syst√®me de notifications est maintenant activ√©', 'info');
                log('2. Testez manuellement dans espace participant', 'info');
                log('3. Ou utilisez les boutons de test automatique', 'info');
                log('4. V√©rifiez l\'int√©gration compl√®te ‚úÖ', 'info');
                
                log('üîî Fonctionnalit√©s disponibles:', 'warning');
                log('- Page notifications compl√®te', 'info');
                log('- Filtrage par statut', 'info');
                log('- Actions: lire, supprimer, navigation', 'info');
                log('- Types: success, info, warning, error', 'info');
                log('- Priorit√©s: haute, moyenne, faible', 'info');
                log('- Navigation desktop et mobile', 'info');
            }, 500);
        };
    </script>
</body>
</html>
