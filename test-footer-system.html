<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Footer System - MATC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #007bff;
            margin-top: 0;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin: 5px 0;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .json-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group textarea {
            height: 80px;
            resize: vertical;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Test Footer System - MATC</h1>
            <p>Test complet du syst√®me de gestion du footer</p>
        </div>

        <!-- Status du syst√®me -->
        <div class="test-section">
            <h3>üìä Status du Syst√®me</h3>
            <div id="systemStatus">
                <div class="status info">Initialisation...</div>
            </div>
            <button onclick="checkSystemStatus()">V√©rifier Status</button>
        </div>

        <!-- Test Backend API -->
        <div class="test-section">
            <h3>üîå Test Backend API</h3>
            <div id="backendStatus">
                <div class="status info">En attente...</div>
            </div>
            <button onclick="testBackendConnection()">Test Connexion Backend</button>
            <button onclick="getFooterSettings()">R√©cup√©rer Param√®tres</button>
            <button onclick="createDefaultSettings()">Cr√©er Param√®tres par D√©faut</button>
        </div>

        <!-- Affichage des donn√©es actuelles -->
        <div class="test-section">
            <h3>üìã Donn√©es Footer Actuelles</h3>
            <div id="currentData" class="json-display">Aucune donn√©e charg√©e</div>
            <button onclick="refreshData()">Actualiser</button>
        </div>

        <!-- Test de modification -->
        <div class="test-section">
            <h3>‚úèÔ∏è Test de Modification</h3>
            <div class="grid">
                <div>
                    <div class="form-group">
                        <label>Email de Contact:</label>
                        <input type="email" id="testEmail" value="test@ma-training-consulting.com">
                    </div>
                    <div class="form-group">
                        <label>T√©l√©phone:</label>
                        <input type="text" id="testPhone" value="+33 1 23 45 67 89">
                    </div>
                    <div class="form-group">
                        <label>Adresse:</label>
                        <textarea id="testAddress">123 Avenue des Champs-√âlys√©es, 75008 Paris</textarea>
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Nom de l'entreprise:</label>
                        <input type="text" id="testCompanyName" value="MA-TRAINING-CONSULTING">
                    </div>
                    <div class="form-group">
                        <label>Description:</label>
                        <textarea id="testDescription">Votre partenaire strat√©gique pour la transformation digitale et le d√©veloppement des comp√©tences.</textarea>
                    </div>
                </div>
            </div>
            <button onclick="testUpdate()">Tester Mise √† Jour</button>
            <button onclick="resetToDefault()">R√©initialiser</button>
        </div>

        <!-- Logs des tests -->
        <div class="test-section">
            <h3>üìù Logs des Tests</h3>
            <div id="testLogs" class="json-display">Logs des tests appara√Ætront ici...</div>
            <button onclick="clearLogs()">Effacer Logs</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001';
        let testLogs = [];

        // Fonction pour logger les messages
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            testLogs.push(logEntry);
            
            // Limiter √† 50 logs
            if (testLogs.length > 50) {
                testLogs = testLogs.slice(-50);
            }
            
            document.getElementById('testLogs').textContent = testLogs.join('\n');
            console.log(logEntry);
        }

        // V√©rifier le status du syst√®me
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '<div class="status info">V√©rification en cours...</div>';
            
            try {
                // Test Backend
                const backendResponse = await fetch(`${API_BASE}/api/health`);
                const backendOk = backendResponse.ok;
                
                // Test Footer API
                const footerResponse = await fetch(`${API_BASE}/api/footer-settings`);
                const footerOk = footerResponse.ok;
                
                let statusHtml = '';
                statusHtml += `<div class="status ${backendOk ? 'success' : 'error'}">Backend API: ${backendOk ? 'Connect√©' : 'D√©connect√©'}</div>`;
                statusHtml += `<div class="status ${footerOk ? 'success' : 'error'}">Footer API: ${footerOk ? 'Disponible' : 'Indisponible'}</div>`;
                
                statusDiv.innerHTML = statusHtml;
                log(`System Status - Backend: ${backendOk ? 'OK' : 'FAIL'}, Footer API: ${footerOk ? 'OK' : 'FAIL'}`);
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">Erreur de connexion</div>';
                log(`Erreur system status: ${error.message}`, 'error');
            }
        }

        // Test connexion backend
        async function testBackendConnection() {
            const statusDiv = document.getElementById('backendStatus');
            statusDiv.innerHTML = '<div class="status info">Test en cours...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="status success">Backend connect√© avec succ√®s</div>';
                    log(`Backend connection OK: ${data.message}`);
                } else {
                    statusDiv.innerHTML = '<div class="status error">Erreur backend</div>';
                    log(`Backend connection failed: ${response.status}`, 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = '<div class="status error">Impossible de se connecter au backend</div>';
                log(`Backend connection error: ${error.message}`, 'error');
            }
        }

        // R√©cup√©rer les param√®tres footer
        async function getFooterSettings() {
            try {
                log('R√©cup√©ration des param√®tres footer...');
                const response = await fetch(`${API_BASE}/api/footer-settings`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    document.getElementById('currentData').textContent = JSON.stringify(data.data, null, 2);
                    log('Param√®tres footer r√©cup√©r√©s avec succ√®s');
                    
                    // Remplir les champs de test
                    if (data.data) {
                        document.getElementById('testEmail').value = data.data.contactInfo.email || '';
                        document.getElementById('testPhone').value = data.data.contactInfo.phone || '';
                        document.getElementById('testAddress').value = data.data.contactInfo.address || '';
                        document.getElementById('testCompanyName').value = data.data.companyInfo.name || '';
                        document.getElementById('testDescription').value = data.data.companyInfo.description || '';
                    }
                } else {
                    document.getElementById('currentData').textContent = 'Erreur: ' + (data.message || 'R√©ponse invalide');
                    log(`Erreur r√©cup√©ration: ${data.message || 'R√©ponse invalide'}`, 'error');
                }
            } catch (error) {
                document.getElementById('currentData').textContent = 'Erreur de connexion: ' + error.message;
                log(`Erreur connexion: ${error.message}`, 'error');
            }
        }

        // Cr√©er param√®tres par d√©faut
        async function createDefaultSettings() {
            try {
                log('Cr√©ation des param√®tres par d√©faut...');
                const response = await fetch(`${API_BASE}/api/footer-settings/reset`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('Param√®tres par d√©faut cr√©√©s avec succ√®s');
                    await getFooterSettings(); // Actualiser l'affichage
                } else {
                    log(`Erreur cr√©ation d√©faut: ${data.message || 'Erreur inconnue'}`, 'error');
                }
            } catch (error) {
                log(`Erreur cr√©ation d√©faut: ${error.message}`, 'error');
            }
        }

        // Test de mise √† jour
        async function testUpdate() {
            try {
                log('Test de mise √† jour...');
                
                const updateData = {
                    contactInfo: {
                        email: document.getElementById('testEmail').value,
                        phone: document.getElementById('testPhone').value,
                        address: document.getElementById('testAddress').value
                    },
                    companyInfo: {
                        name: document.getElementById('testCompanyName').value,
                        description: document.getElementById('testDescription').value
                    },
                    faqLinks: [
                        { title: 'Comment s\'inscrire ?', href: '#' },
                        { title: 'Conditions de partenariat', href: '#' },
                        { title: 'Avantages du programme', href: '#' },
                        { title: 'Nos partenaires', href: '#' }
                    ],
                    socialLinks: [
                        { name: 'Facebook', href: '#', icon: 'FaFacebookF' },
                        { name: 'LinkedIn', href: '#', icon: 'FaLinkedinIn' },
                        { name: 'WhatsApp', href: '#', icon: 'FaWhatsapp' },
                        { name: 'Telegram', href: '#', icon: 'FaTelegramPlane' }
                    ]
                };
                
                const response = await fetch(`${API_BASE}/api/footer-settings`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('Mise √† jour r√©ussie');
                    await getFooterSettings(); // Actualiser l'affichage
                } else {
                    log(`Erreur mise √† jour: ${data.message || 'Erreur inconnue'}`, 'error');
                }
            } catch (error) {
                log(`Erreur mise √† jour: ${error.message}`, 'error');
            }
        }

        // R√©initialiser aux valeurs par d√©faut
        async function resetToDefault() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser aux valeurs par d√©faut ?')) {
                await createDefaultSettings();
            }
        }

        // Actualiser les donn√©es
        async function refreshData() {
            await getFooterSettings();
        }

        // Effacer les logs
        function clearLogs() {
            testLogs = [];
            document.getElementById('testLogs').textContent = 'Logs effac√©s...';
        }

        // Initialisation au chargement de la page
        window.onload = function() {
            log('Test Footer System initialis√©');
            checkSystemStatus();
            getFooterSettings();
        };
    </script>
</body>
</html>
