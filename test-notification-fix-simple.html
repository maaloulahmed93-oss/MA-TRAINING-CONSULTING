<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f2f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .critical { background: #ff4757; color: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .success { background: #2ed573; color: white; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .error { background: #ff4757; color: white; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .info { background: #3742fa; color: white; padding: 15px; border-radius: 8px; margin: 15px 0; }
        button { padding: 12px 20px; margin: 10px 5px; background: #3742fa; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
        button:hover { background: #2f3542; }
        button.urgent { background: #ff4757; }
        .result { margin: 10px 0; padding: 12px; border-radius: 6px; background: #f8f9fa; border-left: 4px solid #3742fa; }
        h1 { color: #2f3542; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h1>
        
        <div class="critical">
            <h3>ğŸš¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h3>
            <p>Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§Ø­Ø¯ØŒ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®ØªÙŠÙ†:</p>
            <ul>
                <li>Ù†Ø³Ø®Ø© Ù…Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Admin Panel</li>
                <li>Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ø±Ø§Ø¨Ø· ØªØ¸Ù‡Ø± ÙÙŠ Espace Participant</li>
            </ul>
        </div>

        <button onclick="checkCurrentData()" class="urgent">ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
        <button onclick="cleanLocalStorage()">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ localStorage</button>
        <button onclick="testInstructions()">ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>

        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            results.appendChild(div);
        }

        async function checkCurrentData() {
            log('ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©...', 'info');
            
            try {
                // Check API
                const response = await fetch('http://localhost:3001/api/participants/PART-550776/notifications');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.data) {
                        log(`ğŸ“Š Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${data.data.length} Ø¥Ø´Ø¹Ø§Ø±`, 'success');
                        
                        data.data.forEach((notif, index) => {
                            log(`ğŸ“‹ ${index + 1}. "${notif.title}" - Ø±Ø§Ø¨Ø·: ${notif.link ? 'âœ…' : 'âŒ'}`, notif.link ? 'success' : 'error');
                        });
                    }
                } else {
                    log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
                
                // Check localStorage
                const backup = localStorage.getItem('matc_notifications_backup');
                if (backup) {
                    const notifications = JSON.parse(backup);
                    log(`ğŸ’¾ localStorage: ${notifications.length} Ø¥Ø´Ø¹Ø§Ø±`, 'info');
                    
                    notifications.forEach((notif, index) => {
                        log(`ğŸ“‹ ${index + 1}. "${notif.title}" - Ø±Ø§Ø¨Ø·: ${notif.link ? 'âœ…' : 'âŒ'}`, notif.link ? 'success' : 'error');
                    });
                } else {
                    log('ğŸ“ localStorage ÙØ§Ø±Øº', 'info');
                }
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        function cleanLocalStorage() {
            log('ğŸ§¹ ØªÙ†Ø¸ÙŠÙ localStorage...', 'info');
            
            // Remove notifications backup
            localStorage.removeItem('matc_notifications_backup');
            log('âœ… ØªÙ… Ø­Ø°Ù matc_notifications_backup', 'success');
            
            // List all MATC related items
            const matcKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.toLowerCase().includes('matc')) {
                    matcKeys.push(key);
                }
            }
            
            if (matcKeys.length > 0) {
                log(`ğŸ” Ø¹Ù†Ø§ØµØ± MATC Ø£Ø®Ø±Ù‰ ÙÙŠ localStorage: ${matcKeys.join(', ')}`, 'info');
                
                matcKeys.forEach(key => {
                    localStorage.removeItem(key);
                    log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${key}`, 'success');
                });
            }
            
            log('ğŸ‰ ØªÙ… ØªÙ†Ø¸ÙŠÙ localStorage Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', 'success');
        }

        function testInstructions() {
            log('ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', 'info');
            log('1. Ù†Ø¸Ù localStorage Ø¨Ø§Ù„Ø²Ø± Ø£Ø¹Ù„Ø§Ù‡', 'info');
            log('2. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Admin Panel: http://localhost:8536/participants', 'info');
            log('3. Ø§Ø¨Ø­Ø« Ø¹Ù† "ismael gharbi"', 'info');
            log('4. Ø§Ø¶ØºØ· "Modifier"', 'info');
            log('5. Ø£Ø¶Ù Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø±Ø§Ø¨Ø·', 'info');
            log('6. Ø§Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª', 'info');
            log('7. Ø§Ø±Ø¬Ø¹ Ù‡Ù†Ø§ ÙˆØ§Ø¶ØºØ· "ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©"', 'info');
            log('8. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Espace Participant: http://localhost:5173/espace-participant', 'info');
            log('9. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„: PART-550776 / gharbi@gmail.com', 'info');
            log('10. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ø±Ø§Ø¨Ø·', 'info');
        }

        // Auto-run
        window.onload = function() {
            setTimeout(() => {
                log('ğŸ¯ Ø£Ø¯Ø§Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'success');
                log('ğŸ”§ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:', 'info');
                log('   âœ… Ù…Ù†Ø¹ Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage', 'success');
                log('   âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù… ÙƒÙ…ØµØ¯Ø± Ø£Ø³Ø§Ø³ÙŠ', 'success');
                log('   âœ… ØªØ¨Ø³ÙŠØ· Ù…Ù†Ø·Ù‚ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª', 'success');
                
                checkCurrentData();
            }, 1000);
        };
    </script>
</body>
</html>
