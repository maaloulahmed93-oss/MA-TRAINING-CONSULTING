<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù‚Ø±Ø§Ø±Ø§Øª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #4f46e5;
        }
        
        .section h2 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .btn-info { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        
        .decision {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .decision-success {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }
        
        .decision-error {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }
        
        .results {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            grid-column: 1 / -1;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4f46e5;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }
        
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h1>
            <p>Backend API + Frontend Integration + localStorage Fallback</p>
            <div style="margin-top: 15px;">
                <span>Backend Status: </span>
                <span id="backendStatus">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...</span>
                <span class="status-indicator" id="statusIndicator"></span>
            </div>
        </div>
        
        <div class="content">
            <!-- Admin Panel Section -->
            <div class="section">
                <h2>ğŸ¢ Admin Panel - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h2>
                <div class="form-group">
                    <label>Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±:</label>
                    <select id="adminFreelancerId">
                        <option value="FRE-340255">FRE-340255 (ismail)</option>
                        <option value="FRE-269251">FRE-269251 (azmd)</option>
                        <option value="FRE-123456">FRE-123456 (test)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ Livrable:</label>
                    <input type="text" id="adminDeliverableTitle" value="Fiche technique - Phase 1">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù‚Ø±Ø§Ø±:</label>
                    <select id="adminDecision">
                        <option value="approved">Ù…Ù‚Ø¨ÙˆÙ„ (AcceptÃ©)</option>
                        <option value="rejected">Ù…Ø±ÙÙˆØ¶ (RefusÃ©)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                    <textarea id="adminObservation" rows="3">Ø¹Ù…Ù„ Ù…Ù…ØªØ§Ø²! ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù€ Livrable Ø¨Ù†Ø¬Ø§Ø­.</textarea>
                </div>
                <button class="btn" onclick="sendDecisionViaAPI()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± API</button>
                <button class="btn btn-info" onclick="sendDecisionViaLocalStorage()">ğŸ’¾ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± localStorage</button>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalSent">0</div>
                        <div>Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø±Ø³Ù„Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="apiSuccess">0</div>
                        <div>Ù†Ø¬Ø­ API</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="localStorageUsed">0</div>
                        <div>localStorage</div>
                    </div>
                </div>
            </div>
            
            <!-- Espace Freelancer Section -->
            <div class="section">
                <h2>ğŸ‘¤ Espace Freelancer - Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h2>
                <div class="form-group">
                    <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±:</label>
                    <select id="freelancerViewId" onchange="loadFreelancerDecisions()">
                        <option value="FRE-340255">FRE-340255 (ismail)</option>
                        <option value="FRE-269251">FRE-269251 (azmd)</option>
                        <option value="FRE-123456">FRE-123456 (test)</option>
                    </select>
                </div>
                <button class="btn btn-info" onclick="loadFreelancerDecisions()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</button>
                <button class="btn btn-success" onclick="testAPIConnection()">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± API</button>
                <button class="btn btn-danger" onclick="clearFreelancerDecisions()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</button>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="freelancerTotal">0</div>
                        <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="freelancerUnread">0</div>
                        <div>ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="freelancerApproved">0</div>
                        <div>Ù…Ù‚Ø¨ÙˆÙ„Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="freelancerRejected">0</div>
                        <div>Ù…Ø±ÙÙˆØ¶Ø©</div>
                    </div>
                </div>
                
                <div id="freelancerDecisionsList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ù€ JavaScript -->
                </div>
            </div>
            
            <!-- Results Section -->
            <div class="section">
                <h2>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                <div class="results" id="results">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„...\n</div>
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let backendAvailable = false;
        let totalSent = 0;
        let apiSuccessCount = 0;
        let localStorageCount = 0;

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            results.textContent += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
            console.log(message);
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Backend
        async function checkBackendStatus() {
            try {
                const response = await fetch('http://localhost:3001/api/freelancer-decisions/FRE-123456', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    backendAvailable = true;
                    document.getElementById('backendStatus').textContent = 'âœ… Ù…ØªØµÙ„';
                    document.getElementById('statusIndicator').className = 'status-indicator status-online';
                    log('âœ… Backend API Ù…ØªØ§Ø­ ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                backendAvailable = false;
                document.getElementById('backendStatus').textContent = 'âŒ ØºÙŠØ± Ù…ØªØµÙ„';
                document.getElementById('statusIndicator').className = 'status-indicator status-offline';
                log(`âŒ Backend API ØºÙŠØ± Ù…ØªØ§Ø­: ${error.message}`);
                log('ğŸ’¾ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… localStorage ÙƒÙ€ fallback');
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± Ø¹Ø¨Ø± API
        async function sendDecisionViaAPI() {
            const freelancerId = document.getElementById('adminFreelancerId').value;
            const freelancerName = freelancerId === 'FRE-340255' ? 'ismail' : 
                                 freelancerId === 'FRE-269251' ? 'azmd' : 'test';
            const deliverableTitle = document.getElementById('adminDeliverableTitle').value;
            const decision = document.getElementById('adminDecision').value;
            const observation = document.getElementById('adminObservation').value;

            try {
                log(`ğŸ“¤ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± Ø¹Ø¨Ø± API Ù„Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± ${freelancerId}...`);
                
                const response = await fetch('http://localhost:3001/api/freelancer-decisions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        freelancerId,
                        freelancerName,
                        deliverableTitle,
                        decision,
                        observation,
                        adminId: 'admin'
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    log(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ø¨Ø± API: ${result.data._id}`);
                    apiSuccessCount++;
                    updateStats();
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø± Ø¹Ø¨Ø± API: ${error.message}`);
                log('ğŸ’¾ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ localStorage...');
                await sendDecisionViaLocalStorage();
            }
            
            totalSent++;
            updateStats();
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„Ø´Ø®Øµ
            const viewId = document.getElementById('freelancerViewId').value;
            if (viewId === freelancerId) {
                setTimeout(loadFreelancerDecisions, 500);
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± Ø¹Ø¨Ø± localStorage
        async function sendDecisionViaLocalStorage() {
            const freelancerId = document.getElementById('adminFreelancerId').value;
            const freelancerName = freelancerId === 'FRE-340255' ? 'ismail' : 
                                 freelancerId === 'FRE-269251' ? 'azmd' : 'test';
            const deliverableTitle = document.getElementById('adminDeliverableTitle').value;
            const decision = document.getElementById('adminDecision').value;
            const observation = document.getElementById('adminObservation').value;

            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø± Ù…Ø­Ù„ÙŠ
                const localDecision = {
                    _id: `local-${Date.now()}`,
                    freelancerId,
                    freelancerName,
                    deliverableTitle,
                    decision,
                    observation,
                    adminId: 'admin',
                    status: 'sent',
                    readAt: null,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Ø­ÙØ¸ ÙÙŠ localStorage
                const key = `freelancerDecisions_${freelancerId}`;
                const existingDecisions = JSON.parse(localStorage.getItem(key) || '[]');
                existingDecisions.unshift(localDecision);
                localStorage.setItem(key, JSON.stringify(existingDecisions));

                log(`ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø± ÙÙŠ localStorage Ù„Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± ${freelancerId}`);
                localStorageCount++;
                
                if (!totalSent) totalSent = 0;
                totalSent++;
                updateStats();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø± ÙÙŠ localStorage: ${error.message}`);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±
        async function loadFreelancerDecisions() {
            const freelancerId = document.getElementById('freelancerViewId').value;
            
            try {
                log(`ğŸ“¬ ØªØ­Ù…ÙŠÙ„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± ${freelancerId}...`);
                
                let decisions = [];
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ù…Ù† API Ø£ÙˆÙ„Ø§Ù‹
                if (backendAvailable) {
                    try {
                        const response = await fetch(`http://localhost:3001/api/freelancer-decisions/${freelancerId}`);
                        if (response.ok) {
                            const result = await response.json();
                            decisions = result.data || [];
                            log(`âœ… ØªÙ… Ø¬Ù„Ø¨ ${decisions.length} Ù‚Ø±Ø§Ø± Ù…Ù† API`);
                        }
                    } catch (apiError) {
                        log(`âš ï¸ ÙØ´Ù„ Ø¬Ù„Ø¨ Ù…Ù† API: ${apiError.message}`);
                    }
                }
                
                // Ø¬Ù„Ø¨ Ù…Ù† localStorage ÙƒÙ€ fallback Ø£Ùˆ Ø¥Ø¶Ø§ÙØ©
                const localKey = `freelancerDecisions_${freelancerId}`;
                const localDecisions = JSON.parse(localStorage.getItem(localKey) || '[]');
                
                if (localDecisions.length > 0) {
                    log(`ğŸ’¾ ØªÙ… Ø¬Ù„Ø¨ ${localDecisions.length} Ù‚Ø±Ø§Ø± Ù…Ù† localStorage`);
                    // Ø¯Ù…Ø¬ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø§Øª
                    const allDecisions = [...decisions, ...localDecisions];
                    const uniqueDecisions = allDecisions.filter((decision, index, self) => 
                        index === self.findIndex(d => d._id === decision._id)
                    );
                    decisions = uniqueDecisions;
                }
                
                displayFreelancerDecisions(decisions);
                updateFreelancerStats(decisions);
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±: ${error.message}`);
            }
        }

        // Ø¹Ø±Ø¶ Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±
        function displayFreelancerDecisions(decisions) {
            const container = document.getElementById('freelancerDecisionsList');
            
            if (decisions.length === 0) {
                container.innerHTML = `
                    <div class="decision">
                        <h4>ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø±Ø§Øª</h4>
                        <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø£ÙŠ Ù‚Ø±Ø§Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± Ø¨Ø¹Ø¯.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = decisions.map(decision => `
                <div class="decision ${decision.decision === 'approved' ? 'decision-success' : 'decision-error'}">
                    <div style="display: flex; justify-content: between; align-items: start;">
                        <div style="flex: 1;">
                            <h4>${decision.decision === 'approved' ? 'âœ… Livrable AcceptÃ©' : 'âŒ Livrable RefusÃ©'} 
                                ${decision.status === 'sent' ? 'ğŸ”´ Ø¬Ø¯ÙŠØ¯' : 'ğŸ‘ï¸ Ù…Ù‚Ø±ÙˆØ¡'}</h4>
                            <p><strong>Livrable:</strong> ${decision.deliverableTitle}</p>
                            <p><strong>DÃ©cision:</strong> ${decision.decision === 'approved' ? 'AcceptÃ©' : 'RefusÃ©'}</p>
                            ${decision.observation ? `<p><strong>Observation:</strong> ${decision.observation}</p>` : ''}
                            <small style="color: #6b7280;">
                                ğŸ“… ${new Date(decision.createdAt).toLocaleString('ar-SA')} | 
                                ğŸ‘¤ De: ${decision.adminId} |
                                ğŸ†” ${decision._id.startsWith('local-') ? 'localStorage' : 'API'}
                            </small>
                        </div>
                        <div>
                            ${decision.status === 'sent' ? `
                                <button class="btn" style="padding: 5px 10px; font-size: 12px;" 
                                        onclick="markDecisionAsRead('${decision._id}', '${decision.freelancerId}')">
                                    ğŸ“– ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ØªØ­Ø¯ÙŠØ¯ Ù‚Ø±Ø§Ø± ÙƒÙ…Ù‚Ø±ÙˆØ¡
        async function markDecisionAsRead(decisionId, freelancerId) {
            try {
                log(`ğŸ“– ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚Ø±Ø§Ø± ${decisionId} ÙƒÙ…Ù‚Ø±ÙˆØ¡...`);
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ø¨Ø± API
                if (backendAvailable && !decisionId.startsWith('local-')) {
                    try {
                        const response = await fetch(`http://localhost:3001/api/freelancer-decisions/${decisionId}/read`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ freelancerId })
                        });
                        
                        if (response.ok) {
                            log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø±Ø§Ø± Ø¹Ø¨Ø± API`);
                        }
                    } catch (apiError) {
                        log(`âš ï¸ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø¹Ø¨Ø± API: ${apiError.message}`);
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« ÙÙŠ localStorage
                const localKey = `freelancerDecisions_${freelancerId}`;
                const localDecisions = JSON.parse(localStorage.getItem(localKey) || '[]');
                const updatedDecisions = localDecisions.map(decision => 
                    decision._id === decisionId 
                        ? { ...decision, status: 'read', readAt: new Date().toISOString() }
                        : decision
                );
                localStorage.setItem(localKey, JSON.stringify(updatedDecisions));
                
                log(`ğŸ’¾ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø±Ø§Ø± ÙÙŠ localStorage`);
                loadFreelancerDecisions();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø±Ø§Ø±: ${error.message}`);
            }
        }

        // Ø­Ø°Ù Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±
        function clearFreelancerDecisions() {
            const freelancerId = document.getElementById('freelancerViewId').value;
            
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ù„Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± ${freelancerId}ØŸ`)) {
                const localKey = `freelancerDecisions_${freelancerId}`;
                localStorage.removeItem(localKey);
                log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ù„Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø± ${freelancerId}`);
                loadFreelancerDecisions();
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ API
        async function testAPIConnection() {
            log('ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§ØªØµØ§Ù„ API...');
            await checkBackendStatus();
            
            if (backendAvailable) {
                // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
                try {
                    const testDecision = {
                        freelancerId: 'FRE-123456',
                        freelancerName: 'Test User',
                        deliverableTitle: 'Test Deliverable',
                        decision: 'approved',
                        observation: 'Ù‡Ø°Ø§ Ù‚Ø±Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±',
                        adminId: 'test-admin'
                    };
                    
                    const response = await fetch('http://localhost:3001/api/freelancer-decisions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testDecision)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        log(`âœ… Ø§Ø®ØªØ¨Ø§Ø± API Ù†Ø¬Ø­: ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ ${result.data._id}`);
                    }
                } catch (error) {
                    log(`âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± API: ${error.message}`);
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            document.getElementById('totalSent').textContent = totalSent;
            document.getElementById('apiSuccess').textContent = apiSuccessCount;
            document.getElementById('localStorageUsed').textContent = localStorageCount;
        }

        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙØ±ÙŠÙ„Ø§Ù†Ø³Ø±
        function updateFreelancerStats(decisions) {
            const total = decisions.length;
            const unread = decisions.filter(d => d.status === 'sent').length;
            const approved = decisions.filter(d => d.decision === 'approved').length;
            const rejected = decisions.filter(d => d.decision === 'rejected').length;
            
            document.getElementById('freelancerTotal').textContent = total;
            document.getElementById('freelancerUnread').textContent = unread;
            document.getElementById('freelancerApproved').textContent = approved;
            document.getElementById('freelancerRejected').textContent = rejected;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        document.addEventListener('DOMContentLoaded', async function() {
            log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...');
            
            // ÙØ­Øµ Backend
            await checkBackendStatus();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            await loadFreelancerDecisions();
            
            log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
            log('ğŸ“‹ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§');
            log('ğŸ”„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¯Ø¹Ù… API + localStorage fallback');
        });
    </script>
</body>
</html>
