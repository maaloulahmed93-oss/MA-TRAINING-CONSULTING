<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Ø¥ØµÙ„Ø§Ø­ localStorage Ù„Ù„Ù‚Ø±Ø§Ø±Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
            font-size: 16px;
        }
        .btn:hover { background: #3730a3; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .results {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin-top: 20px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø¥ØµÙ„Ø§Ø­ localStorage Ù„Ù„Ù‚Ø±Ø§Ø±Ø§Øª</h1>
        <p>Ø­Ù„ Ø³Ø±ÙŠØ¹ Ù„Ù…Ø´ÙƒÙ„Ø© Ø¹Ø¯Ù… Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙÙŠ Espace Freelancer</p>
        
        <button class="btn btn-success" onclick="createDecisionsDirectly()">
            âœ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
        </button>
        
        <button class="btn" onclick="checkLocalStorage()">
            ğŸ” ÙØ­Øµ localStorage
        </button>
        
        <button class="btn" onclick="clearAndRecreate()">
            ğŸ”„ Ù…Ø³Ø­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡
        </button>
        
        <div class="results" id="results">Ø¬Ø§Ù‡Ø² Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©...</div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            results.textContent += `[${timestamp}] ${message}\n`;
        }

        function createDecisionsDirectly() {
            log('ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ localStorage...');
            
            const freelancerId = 'FRE-340255';
            const decisions = [
                {
                    _id: `decision-direct-1-${Date.now()}`,
                    freelancerId: freelancerId,
                    freelancerName: 'ismail',
                    deliverableTitle: 'Design Interface Utilisateur',
                    decision: 'approved',
                    observation: 'Ø¹Ù…Ù„ Ù…Ù…ØªØ§Ø²! Ø§Ù„ØªØµÙ…ÙŠÙ… ÙŠÙ„Ø¨ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.',
                    adminId: 'admin',
                    status: 'sent',
                    readAt: null,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                },
                {
                    _id: `decision-direct-2-${Date.now()}`,
                    freelancerId: freelancerId,
                    freelancerName: 'ismail',
                    deliverableTitle: 'Documentation Technique',
                    decision: 'rejected',
                    observation: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚. Ù‡Ù†Ø§Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ†.',
                    adminId: 'admin',
                    status: 'sent',
                    readAt: null,
                    createdAt: new Date(Date.now() - 60000).toISOString(),
                    updatedAt: new Date(Date.now() - 60000).toISOString()
                }
            ];
            
            try {
                const key = `freelancerDecisions_${freelancerId}`;
                localStorage.setItem(key, JSON.stringify(decisions));
                
                // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­ÙØ¸
                const saved = localStorage.getItem(key);
                const parsed = JSON.parse(saved);
                
                log(`âœ… ØªÙ… Ø­ÙØ¸ ${parsed.length} Ù‚Ø±Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!`);
                log(`ğŸ“‹ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø£ÙˆÙ„: ${parsed[0].deliverableTitle} - ${parsed[0].decision}`);
                log(`ğŸ“‹ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ: ${parsed[1].deliverableTitle} - ${parsed[1].decision}`);
                log('ğŸ¯ Ø§Ø°Ù‡Ø¨ Ø§Ù„Ø¢Ù† Ø¥Ù„Ù‰ Espace Freelancer â†’ Notifications');
                log('ğŸ”„ Ø§Ø¶ØºØ· F5 Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ${error.message}`);
            }
        }

        function checkLocalStorage() {
            log('ğŸ” ÙØ­Øµ localStorage...');
            
            const freelancerId = 'FRE-340255';
            const key = `freelancerDecisions_${freelancerId}`;
            
            try {
                const data = localStorage.getItem(key);
                
                if (!data) {
                    log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø±Ø§Ø±Ø§Øª ÙÙŠ localStorage');
                    log('ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ù… "Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©"');
                } else {
                    const decisions = JSON.parse(data);
                    log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${decisions.length} Ù‚Ø±Ø§Ø±`);
                    
                    decisions.forEach((decision, index) => {
                        log(`${index + 1}. ${decision.deliverableTitle} - ${decision.decision}`);
                    });
                }
                
                // ÙØ­Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                const allKeys = Object.keys(localStorage);
                const decisionKeys = allKeys.filter(k => k.includes('Decision') || k.includes('decision'));
                log(`ğŸ”‘ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: ${decisionKeys.length}`);
                decisionKeys.forEach(k => log(`  - ${k}`));
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ: ${error.message}`);
            }
        }

        function clearAndRecreate() {
            log('ğŸ”„ Ù…Ø³Ø­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡...');
            
            const freelancerId = 'FRE-340255';
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            localStorage.removeItem(`freelancerDecisions_${freelancerId}`);
            localStorage.removeItem(`freelancerNotifications_${freelancerId}`);
            
            log('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©');
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡
            setTimeout(() => {
                createDecisionsDirectly();
            }, 500);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        log('ğŸš€ Ø£Ø¯Ø§Ø© Ø¥ØµÙ„Ø§Ø­ localStorage Ø¬Ø§Ù‡Ø²Ø©');
        log('ğŸ“‹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: FreelancerDecisionsService Ù„Ø§ ÙŠØ¬Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª');
        log('ğŸ”§ Ø§Ù„Ø­Ù„: Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ localStorage');
    </script>
</body>
</html>
