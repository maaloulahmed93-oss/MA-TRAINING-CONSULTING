# 🏢 دليل النظام التجاري الجديد - MATC

## 📋 نظرة عامة

تم تطوير **النظام التجاري الجديد** ليحل محل النظام القديم بنظام ثلاثي المستويات أكثر فعالية ووضوحاً. النظام يوفر تدرج واضح للمستويات مع مكافآت وامتيازات محددة لكل مستوى.

---

## 🎯 المستويات الثلاثة

### 🔹 المستوى 1: Apprenti Vendeur (المتدرب)
- **المتطلبات:** البداية (0 نقطة)
- **المكاسب:** +5 نقاط لكل بيع مؤكد
- **الامتيازات:**
  - الوصول للبرامج المخصصة من الإدارة
  - دعم العملاء الأساسي
  - تتبع النقاط والمبيعات
- **شرط الترقية:** 1000 نقطة

### 🔹 المستوى 2: Vendeur Confirmé (البائع المؤكد)
- **المتطلبات:** 1000 نقطة
- **المكاسب:** جميع مكاسب المستوى 1 +
  - إدارة محفظة العملاء
  - تتبع رقم الأعمال (CA)
  - إمكانية التحويل للشركة
- **شرط الترقية:** تحويل 500€ للشركة

### 🔹 المستوى 3: Partenaire Officiel (الشريك الرسمي)
- **المتطلبات:** تحويل 500€ من رقم الأعمال
- **المكاسب:**
  - 20% عمولة مباشرة على كل بيع
  - 5€ هدية شهرية تلقائية
  - وصول أولوي للبرامج الجديدة
  - دعم تجاري مخصص
  - جميع امتيازات المستويات السابقة

---

## 🔧 المكونات التقنية

### Backend (Node.js + MongoDB)

#### Models:
- **CommercialNew.js** - النموذج الرئيسي للتجاري
- **CommercialService.js** - إدارة الخدمات والبرامج

#### API Endpoints:
```
/api/commercial-new/:partnerId/login          - تسجيل الدخول
/api/commercial-new/:partnerId                - بيانات التجاري
/api/commercial-new/:partnerId/services       - الخدمات المخصصة
/api/commercial-new/:partnerId/vente          - إضافة بيع
/api/commercial-new/:partnerId/client         - إضافة عميل (مستوى 2+)
/api/commercial-new/:partnerId/transfert      - تحويل للشركة (مستوى 2)
/api/commercial-new/:partnerId/stats          - الإحصائيات
/api/commercial-new/admin/service             - إنشاء خدمة (إدارة)
/api/commercial-new/admin/assign-service      - تخصيص خدمة (إدارة)
```

### Frontend (React + TypeScript)

#### Components:
- **EspaceCommercialNewPage.tsx** - الصفحة الرئيسية
- **CommercialNewDashboard.tsx** - لوحة التحكم
- **commercialNewApiService.ts** - خدمة API

#### Admin Panel:
- **CommercialServicesManager.tsx** - إدارة الخدمات

---

## 🔐 نظام الأمان - Secret Code

### الكود السري: `20388542`

يستخدم هذا الكود لحماية العمليات الإدارية:
- إنشاء خدمات/برامج جديدة
- تخصيص الخدمات للتجاريين
- إضافة الهدايا الشهرية

### كيفية الاستخدام:
1. الإدارة تدخل الكود السري عند إنشاء خدمة
2. النظام يتحقق من الكود في الخادم
3. التجاري لا يرى الكود ولا يمكنه تعديل قائمة خدماته

---

## 🚀 دليل التشغيل

### 1. تشغيل النظام
```bash
# تشغيل تلقائي لجميع الخدمات
./start-commercial-new-system.bat

# أو تشغيل يدوي:
# Backend
cd backend && npm run dev

# Site Principal  
npm run dev

# Admin Panel
cd admin-panel && npm run dev
```

### 2. URLs الوصول
- **Backend API:** http://localhost:3001
- **Site Principal:** http://localhost:5173
- **Admin Panel:** http://localhost:8536
- **Espace Commercial:** http://localhost:5173/espace-commercial-new
- **إدارة الخدمات:** http://localhost:8536/commercial-services

### 3. اختبار النظام
افتح ملف: `test-commercial-new-system.html` لاختبار شامل لجميع الوظائف

---

## 👨‍💼 دليل الإدارة

### إنشاء خدمة جديدة:
1. اذهب إلى Admin Panel → Services Commerciaux
2. اضغط "Nouveau Service"
3. املأ البيانات (العنوان، السعر، العمولة، إلخ)
4. ادخل الكود السري: `20388542`
5. اضغط "Créer"

### تخصيص خدمة لتجاري:
1. في قائمة الخدمات، اضغط "Attribuer"
2. اختر التجاري من القائمة
3. ادخل الكود السري: `20388542`
4. اضغط "Attribuer"

### إضافة الهدايا الشهرية:
```bash
POST /api/commercial-new/admin/cadeaux-mensuels
Body: { "secretCode": "20388542" }
```

---

## 👤 دليل التجاري

### تسجيل الدخول:
1. اذهب إلى: http://localhost:5173/espace-commercial-new
2. ادخل ID التجاري (مثال: COMM-123456)
3. اضغط "Se Connecter"

### إضافة بيع:
1. اذهب إلى تبويب "Ventes"
2. اختر الخدمة من القائمة
3. ادخل بيانات العميل
4. اضغط "Ajouter Vente"
5. ستحصل على +5 نقاط تلقائياً

### إدارة العملاء (مستوى 2+):
1. اذهب إلى تبويب "Clients"
2. ادخل بيانات العميل الجديد
3. اضغط "Ajouter Client"

### التحويل للشركة (مستوى 2):
1. اذهب إلى تبويب "Transfert"
2. تأكد من وجود 500€ رقم أعمال
3. اضغط "Transférer 500€ → Niveau 3"

---

## 📊 الإحصائيات والتتبع

### للتجاري:
- النقاط الحالية والتاريخية
- رقم الأعمال الإجمالي
- العمولة المتراكمة
- عدد المبيعات والعملاء
- الهدايا الشهرية (مستوى 3)

### للإدارة:
- إحصائيات استخدام كل خدمة
- العمولات المدفوعة
- رقم الأعمال المُحقق
- عدد التجاريين لكل خدمة

---

## 🔄 سير العمل (Workflow)

```
1. الإدارة تنشئ خدمات جديدة (مع الكود السري)
2. الإدارة تخصص الخدمات للتجاريين
3. التجاري يسجل دخول ويرى خدماته المخصصة
4. التجاري يضيف مبيعات ويكسب نقاط
5. عند 1000 نقطة → ترقية تلقائية للمستوى 2
6. المستوى 2: يمكن إدارة العملاء وتحويل الأموال
7. عند تحويل 500€ → ترقية تلقائية للمستوى 3
8. المستوى 3: عمولة مباشرة 20% + هدايا شهرية
```

---

## 🛠️ استكشاف الأخطاء

### مشاكل شائعة:

#### 1. خطأ في تسجيل الدخول:
- تأكد من صحة ID التجاري
- تأكد من تشغيل Backend على المنفذ 3001
- تحقق من إنشاء التجاري في قاعدة البيانات

#### 2. الخدمات لا تظهر:
- تأكد من تخصيص الخدمات للتجاري من Admin Panel
- تحقق من استخدام الكود السري الصحيح

#### 3. النقاط لا تُضاف:
- تأكد من حالة البيع = "confirmé"
- تحقق من صحة بيانات الخدمة المختارة

#### 4. مشكلة في الترقية:
- المستوى 1→2: تحقق من وصول النقاط إلى 1000
- المستوى 2→3: تأكد من تحويل 500€ بالضبط

---

## 📝 ملاحظات مهمة

### الأمان:
- الكود السري محفوظ في Backend فقط
- التجاري لا يمكنه رؤية أو تعديل الكود
- جميع العمليات الإدارية محمية بالكود

### قاعدة البيانات:
- MongoDB Atlas متصل على: `matc_db`
- Collections: `commercialnews`, `commercialservices`
- Backup تلقائي كل 24 ساعة

### الأداء:
- Cache المحلي للجلسات (24 ساعة)
- تحديث تلقائي للإحصائيات
- تحميل البيانات عند الطلب

---

## 🔮 التطويرات المستقبلية

### المخطط لها:
- [ ] تقارير مفصلة للإدارة
- [ ] إشعارات البريد الإلكتروني للترقيات
- [ ] تطبيق موبايل للتجاريين
- [ ] نظام المكافآت الإضافية
- [ ] تكامل مع أنظمة المحاسبة

### اقتراحات:
- نظام التقييم للتجاريين
- مسابقات شهرية
- برنامج الإحالة
- تدريبات أونلاين

---

## 📞 الدعم التقني

### للمشاكل التقنية:
1. تحقق من ملف `test-commercial-new-system.html`
2. راجع logs الخادم في Console
3. تأكد من تشغيل جميع الخدمات
4. أعد تشغيل النظام إذا لزم الأمر

### للاستفسارات:
- البريد الإلكتروني: tech@matc.tn
- الهاتف: +216 XX XXX XXX
- الساعات: 9:00 - 17:00 (الاثنين - الجمعة)

---

**© 2025 MA Training & Consulting - جميع الحقوق محفوظة**

*آخر تحديث: 17 سبتمبر 2025*
