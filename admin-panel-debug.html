<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ÙØ­Øµ Admin Panel - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #7c3aed 0%, #4c1d95 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            color: white;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #7c3aed;
        }
        .btn {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
            font-size: 16px;
            display: block;
            width: 100%;
        }
        .btn:hover { background: #6d28d9; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
        .results {
            background: rgba(0,0,0,0.9);
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin-top: 20px;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ÙØ­Øµ Admin Panel - Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŸ</h1>
        
        <button class="btn" onclick="testAdminPanelSend()">
            ğŸ“¤ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† Admin Panel
        </button>
        
        <button class="btn" onclick="simulateRealDecision()">
            ğŸ¯ Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Admin Panel
        </button>
        
        <button class="btn btn-success" onclick="sendRealDecisionNow()">
            ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„Ø¢Ù† (jenn)
        </button>
        
        <button class="btn btn-danger" onclick="clearTestData()">
            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        </button>
        
        <div class="results" id="results">ğŸ” Ø¬Ø§Ù‡Ø² Ù„ÙØ­Øµ Admin Panel...\n\n</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            results.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            results.scrollTop = results.scrollHeight;
        }

        async function testAdminPanelSend() {
            log('ğŸ“¤ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† Admin Panel...', 'warning');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ±Ø³Ù„Ù‡Ø§ Admin Panel
            const adminPanelData = {
                freelancerId: 'FRE-340255',
                freelancerName: 'ismail',
                deliverableTitle: 'jenn', // Ù‡Ø°Ø§ Ù…Ø§ ÙŠÙØ¯Ø®Ù„ ÙÙŠ Admin Panel
                decision: 'approved',
                observation: 'Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Admin Panel - ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
                adminId: 'admin'
            };
            
            log('ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙØ±Ø³Ù„Ø© Ù…Ù† Admin Panel:', 'info');
            log(`  - Freelancer: ${adminPanelData.freelancerName} (${adminPanelData.freelancerId})`, 'info');
            log(`  - Deliverable: ${adminPanelData.deliverableTitle}`, 'info');
            log(`  - Decision: ${adminPanelData.decision}`, 'info');
            log(`  - Observation: ${adminPanelData.observation}`, 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/freelancer-decisions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(adminPanelData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    log(`ğŸ“‹ ID: ${result.data._id}`, 'success');
                    log(`ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(result.data.createdAt).toLocaleString('ar-SA')}`, 'success');
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­ÙØ¸
                    setTimeout(async () => {
                        await checkMongoDBContent();
                    }, 1000);
                    
                } else {
                    log(`âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ${response.status}`, 'error');
                    const errorText = await response.text();
                    log(`ğŸ’¬ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£: ${errorText}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        async function simulateRealDecision() {
            log('ğŸ¯ Ù…Ø­Ø§ÙƒØ§Ø© Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† Admin Panel...', 'warning');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù…Ø§ ÙŠØ­Ø¯Ø« ÙÙŠ Admin Panel
            const formData = {
                freelancerId: 'FRE-340255',
                freelancerName: 'ismail',
                title: 'jenn', // Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                status: 'approved', // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                observation: 'Ø§Ù„Ø¹Ù…Ù„ Ù…Ù…ØªØ§Ø² ÙˆÙŠÙ„Ø¨ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©. ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ³Ù„ÙŠÙ….' // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ù…ÙØ¯Ø®Ù„Ø©
            };
            
            log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:', 'info');
            log(`  - Title: "${formData.title}"`, 'info');
            log(`  - Status: ${formData.status}`, 'info');
            log(`  - Observation: ${formData.observation}`, 'info');
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ø§ ÙŠÙØ¹Ù„ Admin Panel
            const apiPayload = {
                freelancerId: formData.freelancerId,
                freelancerName: formData.freelancerName,
                deliverableTitle: formData.title, // Ù‡Ù†Ø§ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                decision: formData.status, // Ù‡Ù†Ø§ Ø§Ù„ØªØ­ÙˆÙŠÙ„
                observation: formData.observation,
                adminId: 'admin'
            };
            
            log('ğŸ“¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙØ±Ø³Ù„Ø© Ù„Ù„Ù€ API:', 'info');
            log(JSON.stringify(apiPayload, null, 2), 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/freelancer-decisions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(apiPayload)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log('âœ… Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ù†Ø¬Ø­Øª! ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ', 'success');
                    log(`ğŸ“‹ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ù…ÙÙ†Ø´Ø£: ${result.data.deliverableTitle}`, 'success');
                } else {
                    log(`âŒ ÙØ´Ù„Øª Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø©: ${error.message}`, 'error');
            }
        }

        async function sendRealDecisionNow() {
            log('ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„Ø¢Ù†...', 'success');
            
            const realDecisions = [
                {
                    freelancerId: 'FRE-340255',
                    freelancerName: 'ismail',
                    deliverableTitle: 'jenn',
                    decision: 'approved',
                    observation: 'Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ - ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„. Ø§Ù„ØªØµÙ…ÙŠÙ… Ù…Ù…ØªØ§Ø² ÙˆÙŠÙ„Ø¨ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª.',
                    adminId: 'admin'
                },
                {
                    freelancerId: 'FRE-340255',
                    freelancerName: 'ismail',
                    deliverableTitle: 'Documentation Projet jenn',
                    decision: 'rejected',
                    observation: 'Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ - ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚. Ù‡Ù†Ø§Ùƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†.',
                    adminId: 'admin'
                }
            ];
            
            let successCount = 0;
            
            for (const decision of realDecisions) {
                try {
                    const response = await fetch('http://localhost:3001/api/freelancer-decisions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(decision)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        successCount++;
                        log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: ${decision.deliverableTitle}`, 'success');
                    } else {
                        log(`âŒ ÙØ´Ù„: ${decision.deliverableTitle}`, 'error');
                    }
                } catch (error) {
                    log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                }
            }
            
            log(`ğŸ“Š ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${successCount} Ù…Ù† ${realDecisions.length} Ù‚Ø±Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠ`, 'success');
            
            if (successCount > 0) {
                log('ğŸ‰ Ø§Ù„Ø¢Ù† Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Espace Freelancer ÙˆØ³ØªØ¬Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©!', 'success');
                log('ğŸ”„ Ø§Ø¶ØºØ· F5 Ø£Ùˆ Ø²Ø± "Actualiser" Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'warning');
            }
        }

        async function clearTestData() {
            log('ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'warning');
            
            try {
                // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª
                const response = await fetch('http://localhost:3001/api/freelancer-decisions/FRE-340255');
                if (response.ok) {
                    const result = await response.json();
                    const testDecisions = result.data.filter(d => d.deliverableTitle.includes('Test'));
                    
                    log(`ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${testDecisions.length} Ù‚Ø±Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ`, 'info');
                    
                    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø¹Ø¨Ø± API Ø§Ù„Ø­Ø§Ù„ÙŠ
                    // Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† ØªÙ…ÙŠÙŠØ²Ù‡Ø§
                    testDecisions.forEach(decision => {
                        log(`  - ${decision.deliverableTitle} (${decision._id})`, 'warning');
                    });
                    
                    log('ğŸ’¡ Ù„Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©ØŒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© DELETE endpoint', 'warning');
                } else {
                    log('âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª', 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }

        async function checkMongoDBContent() {
            log('ğŸ” ÙØ­Øµ Ù…Ø­ØªÙˆÙ‰ MongoDB...', 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/freelancer-decisions/FRE-340255');
                if (response.ok) {
                    const result = await response.json();
                    
                    log(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª: ${result.data.length}`, 'info');
                    
                    const realDecisions = result.data.filter(d => !d.deliverableTitle.includes('Test'));
                    const testDecisions = result.data.filter(d => d.deliverableTitle.includes('Test'));
                    
                    log(`âœ… Ù‚Ø±Ø§Ø±Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©: ${realDecisions.length}`, 'success');
                    log(`ğŸ§ª Ù‚Ø±Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ${testDecisions.length}`, 'warning');
                    
                    if (realDecisions.length > 0) {
                        log('ğŸ“‹ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©:', 'success');
                        realDecisions.forEach((decision, i) => {
                            log(`  ${i+1}. ${decision.deliverableTitle} - ${decision.decision}`, 'success');
                        });
                    }
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ MongoDB: ${error.message}`, 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ
        window.addEventListener('load', function() {
            log('ğŸ” Ø£Ø¯Ø§Ø© ÙØ­Øµ Admin Panel Ø¬Ø§Ù‡Ø²Ø©', 'success');
            log('ğŸ¯ Ø§Ù„Ù‡Ø¯Ù: Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø±Ø§Ø±Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©', 'warning');
            log('ğŸ“‹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Admin Panel ÙŠØ±Ø³Ù„ Ù„ÙƒÙ† Ù„Ø§ ØªØ¸Ù‡Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©', 'error');
            
            // ÙØ­Øµ Ø£ÙˆÙ„ÙŠ
            setTimeout(checkMongoDBContent, 1000);
        });
    </script>
</body>
</html>
