<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .error { background: #fee; border-color: #fcc; color: #c33; }
        .success { background: #efe; border-color: #cfc; color: #363; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background: #e3f2fd; border-color: #bbdefb; color: #0d47a1; }
        button { padding: 12px 24px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background: #f5f5f5; font-weight: bold; }
        .partner-card { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 6px; background: #fafafa; }
        .type-formateur { border-left: 4px solid #007bff; }
        .type-freelancer { border-left: 4px solid #28a745; }
        .type-commercial { border-left: 4px solid #ffc107; }
        .type-entreprise { border-left: 4px solid #6f42c1; }
        .type-participant { border-left: 4px solid #dc3545; background: #fff5f5; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h1>
        
        <div class="section success">
            <h3>ğŸ‰ ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>
            <ul>
                <li>âœ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ <code>participantData.ts</code></li>
                <li>âœ… Ø¥Ø²Ø§Ù„Ø© "aziz ben ameur" Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù€ IDs Ø§Ù„ØµØ§Ù„Ø­Ø©</li>
                <li>âœ… ØªØ¹Ø·ÙŠÙ„ Auto-Seeding ÙÙŠ <code>ParticipantsPage.tsx</code></li>
                <li>âœ… ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª ØªÙ†Ø¸ÙŠÙ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
            </ul>
        </div>

        <div class="section">
            <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ù‚Ù‚:</h3>
            <button class="btn-primary" onclick="checkDatabase()">
                <span id="checkIcon">ğŸ”</span> ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            <button class="btn-success" onclick="checkAdminPanel()">
                <span id="adminIcon">ğŸ‘¥</span> ÙØ­Øµ Admin Panel
            </button>
            <button class="btn-danger" onclick="searchForAziz()">
                <span id="searchIcon">ğŸ”</span> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† aziz ben ameur
            </button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `section ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function setButtonLoading(buttonId, loading) {
            const btn = document.querySelector(`button[onclick="${buttonId}()"]`);
            if (btn) {
                btn.disabled = loading;
                const icon = btn.querySelector('span');
                if (loading) {
                    icon.innerHTML = '<div class="loading"></div>';
                } else {
                    // Reset icon based on button type
                    if (buttonId === 'checkDatabase') icon.innerHTML = 'ğŸ”';
                    else if (buttonId === 'checkAdminPanel') icon.innerHTML = 'ğŸ‘¥';
                    else if (buttonId === 'searchForAziz') icon.innerHTML = 'ğŸ”';
                }
            }
        }

        async function checkDatabase() {
            setButtonLoading('checkDatabase', true);
            log('ğŸ” ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/partners`);
                const data = await response.json();
                
                if (data.success) {
                    const partners = data.data;
                    
                    // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                    const typeStats = {};
                    let participantFound = false;
                    let azizFound = false;
                    
                    partners.forEach(partner => {
                        typeStats[partner.type] = (typeStats[partner.type] || 0) + 1;
                        
                        if (partner.type === 'participant') {
                            participantFound = true;
                        }
                        
                        if (partner.fullName && partner.fullName.toLowerCase().includes('aziz')) {
                            azizFound = true;
                        }
                    });
                    
                    let statsHtml = '<h4>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</h4>';
                    statsHtml += '<table><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th></tr>';
                    
                    Object.entries(typeStats).forEach(([type, count]) => {
                        const isParticipant = type === 'participant';
                        statsHtml += `<tr ${isParticipant ? 'style="background: #fff5f5; color: #dc3545;"' : ''}><td>${type}</td><td>${count}</td></tr>`;
                    });
                    
                    statsHtml += '</table>';
                    
                    if (participantFound) {
                        statsHtml += '<div class="warning"><strong>âš ï¸ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø´Ø±ÙƒØ§Ø¡ Ù…Ù† Ù†ÙˆØ¹ "participant"!</strong></div>';
                    } else {
                        statsHtml += '<div class="success"><strong>âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡ Ù…Ù† Ù†ÙˆØ¹ "participant"</strong></div>';
                    }
                    
                    if (azizFound) {
                        statsHtml += '<div class="error"><strong>âŒ Ù„Ø§ ÙŠØ²Ø§Ù„ "aziz" Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</strong></div>';
                    } else {
                        statsHtml += '<div class="success"><strong>âœ… ØªÙ… Ø­Ø°Ù "aziz ben ameur" Ø¨Ù†Ø¬Ø§Ø­</strong></div>';
                    }
                    
                    log(statsHtml, participantFound || azizFound ? 'warning' : 'success');
                } else {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ API: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            } finally {
                setButtonLoading('checkDatabase', false);
            }
        }

        async function checkAdminPanel() {
            setButtonLoading('checkAdminPanel', true);
            log('ğŸ‘¥ ÙØ­Øµ Admin Panel...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/partners/stats/overview`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.data;
                    
                    let statsHtml = '<h4>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Admin Panel:</h4>';
                    statsHtml += '<table>';
                    statsHtml += '<tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th></tr>';
                    statsHtml += `<tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</td><td>${stats.total}</td></tr>`;
                    statsHtml += `<tr><td>Formateurs</td><td>${stats.formateurs}</td></tr>`;
                    statsHtml += `<tr><td>Freelancers</td><td>${stats.freelancers}</td></tr>`;
                    statsHtml += `<tr><td>Commerciaux</td><td>${stats.commerciaux}</td></tr>`;
                    statsHtml += `<tr><td>Entreprises</td><td>${stats.entreprises}</td></tr>`;
                    statsHtml += '</table>';
                    
                    const expectedTotal = stats.formateurs + stats.freelancers + stats.commerciaux + stats.entreprises;
                    if (stats.total === expectedTotal) {
                        statsHtml += '<div class="success"><strong>âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ù…Ù† Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµØ­ÙŠØ­Ø© (4 Ø£Ù†ÙˆØ§Ø¹ ÙÙ‚Ø·)</strong></div>';
                    } else {
                        statsHtml += '<div class="warning"><strong>âš ï¸ Ù‚Ø¯ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø£Ø®Ø±Ù‰</strong></div>';
                    }
                    
                    log(statsHtml, stats.total === expectedTotal ? 'success' : 'warning');
                } else {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Admin Panel: ${error.message}`, 'error');
            } finally {
                setButtonLoading('checkAdminPanel', false);
            }
        }

        async function searchForAziz() {
            setButtonLoading('searchForAziz', true);
            log('ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† aziz ben ameur...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/partners`);
                const data = await response.json();
                
                if (data.success) {
                    const partners = data.data;
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† aziz
                    const azizPartners = partners.filter(p => 
                        (p.fullName && p.fullName.toLowerCase().includes('aziz')) ||
                        (p.email && p.email.includes('ameur@gmail.com')) ||
                        (p.partnerId && p.partnerId.includes('834809'))
                    );
                    
                    if (azizPartners.length > 0) {
                        let azizHtml = `<h4>âŒ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${azizPartners.length} Ù†ØªÙŠØ¬Ø© Ù„Ù€ "aziz":</h4>`;
                        azizPartners.forEach(partner => {
                            azizHtml += `
                                <div class="partner-card type-${partner.type}">
                                    <strong>${partner.partnerId}</strong> - ${partner.fullName}<br>
                                    <small>ğŸ“§ ${partner.email} | Ø§Ù„Ù†ÙˆØ¹: ${partner.type}</small><br>
                                    <small>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(partner.createdAt).toLocaleDateString('ar')}</small>
                                </div>
                            `;
                        });
                        azizHtml += '<div class="error"><strong>âŒ ÙŠØ¬Ø¨ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹!</strong></div>';
                        log(azizHtml, 'error');
                    } else {
                        log('<h4>âœ… Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ "aziz ben ameur"</h4><p>ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!</p>', 'success');
                    }
                } else {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${error.message}`, 'error');
            } finally {
                setButtonLoading('searchForAziz', false);
            }
        }

        // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            setTimeout(() => {
                checkDatabase();
            }, 1000);
        };
    </script>
</body>
</html>
