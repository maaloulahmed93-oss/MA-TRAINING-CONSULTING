<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Project URL - MATC Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .error { border-color: #f44336; background: #fff5f5; }
        .success { border-color: #4CAF50; background: #f5fff5; }
        .warning { border-color: #ff9800; background: #fff8f0; }
        .info { border-color: #2196F3; background: #f0f8ff; }
        
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a8b; }
        
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .project-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background: white;
        }
        
        .url-display {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Project URL - MATC Admin Panel</h1>
        <p>Diagnostic pour le probl√®me d'URL qui dispara√Æt apr√®s modification</p>

        <div class="debug-section info">
            <h3>üìã Instructions de test</h3>
            <ol>
                <li>Ouvrir Admin Panel: <code>http://localhost:8536/participants</code></li>
                <li>Ajouter un projet avec URL</li>
                <li>V√©rifier que l'URL appara√Æt dans la liste</li>
                <li>Modifier le projet</li>
                <li>V√©rifier si l'URL dispara√Æt</li>
                <li>Consulter les logs dans la console du navigateur</li>
            </ol>
        </div>

        <div class="debug-section warning">
            <h3>üîß Actions de diagnostic</h3>
            <button onclick="simulateProjectCreation()">Simuler cr√©ation projet</button>
            <button onclick="simulateProjectEdit()">Simuler modification projet</button>
            <button onclick="checkLocalStorage()">V√©rifier localStorage</button>
            <button onclick="clearLogs()">Effacer logs</button>
        </div>

        <div class="debug-section">
            <h3>üìä Simulation de projets</h3>
            <div id="projectsList"></div>
        </div>

        <div class="debug-section">
            <h3>üìù Console Logs</h3>
            <div id="logOutput" class="log">Pr√™t pour les tests...\n</div>
        </div>

        <div class="debug-section info">
            <h3>üîç Points √† v√©rifier</h3>
            <ul>
                <li><strong>Console logs:</strong> V√©rifier les messages üîó dans la console</li>
                <li><strong>State management:</strong> L'URL est-elle dans newProjectDetails?</li>
                <li><strong>Update function:</strong> L'URL est-elle copi√©e dans updatedProject?</li>
                <li><strong>Render:</strong> L'URL est-elle pr√©sente lors du rendu?</li>
            </ul>
        </div>
    </div>

    <script>
        let projects = [];
        let editingIndex = null;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logOutput = document.getElementById('logOutput');
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }

        function renderProjects() {
            const container = document.getElementById('projectsList');
            container.innerHTML = '';
            
            projects.forEach((project, index) => {
                const card = document.createElement('div');
                card.className = 'project-card';
                card.innerHTML = `
                    <h4>${project.title}</h4>
                    <p><strong>Description:</strong> ${project.description}</p>
                    <div class="url-display">
                        <strong>URL:</strong> ${project.projectUrl || '<span style="color: red;">VIDE!</span>'}
                    </div>
                    <button onclick="editProject(${index})">Modifier</button>
                    <button onclick="deleteProject(${index})" style="background: #f44336;">Supprimer</button>
                `;
                container.appendChild(card);
            });
        }

        function simulateProjectCreation() {
            log('üîÑ Simulation: Cr√©ation d\'un nouveau projet');
            
            const newProject = {
                id: `proj-${Date.now()}`,
                title: 'Test Project',
                description: 'Description du projet de test',
                projectUrl: 'https://github.com/test/project-url',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            log(`üîó URL du nouveau projet: ${newProject.projectUrl}`);
            projects.push(newProject);
            log(`üíæ Projet ajout√©. Total: ${projects.length}`);
            
            renderProjects();
        }

        function editProject(index) {
            log(`‚úèÔ∏è Simulation: Modification du projet ${index}`);
            const project = projects[index];
            log(`üîó URL originale: ${project.projectUrl}`);
            
            editingIndex = index;
            
            // Simuler le remplissage du formulaire
            const projectDetails = {
                title: project.title,
                description: project.description,
                projectUrl: project.projectUrl || "",
            };
            
            log(`üìù D√©tails du projet charg√©s: ${JSON.stringify(projectDetails)}`);
            log(`üîó URL dans les d√©tails: ${projectDetails.projectUrl}`);
            
            // Simuler la modification
            setTimeout(() => {
                const newUrl = prompt('Nouvelle URL (ou laissez vide pour garder):', project.projectUrl) || project.projectUrl;
                updateProject(newUrl);
            }, 100);
        }

        function updateProject(newUrl) {
            if (editingIndex === null) return;
            
            log(`üîÑ Simulation: Sauvegarde des modifications`);
            log(`üîó Nouvelle URL: ${newUrl}`);
            
            const updatedProject = {
                ...projects[editingIndex],
                projectUrl: newUrl,
                updatedAt: new Date().toISOString()
            };
            
            log(`üíæ Projet mis √† jour: ${JSON.stringify(updatedProject)}`);
            log(`üîó URL dans le projet mis √† jour: ${updatedProject.projectUrl}`);
            
            projects[editingIndex] = updatedProject;
            editingIndex = null;
            
            log(`‚úÖ Modification termin√©e`);
            renderProjects();
        }

        function simulateProjectEdit() {
            if (projects.length === 0) {
                simulateProjectCreation();
                setTimeout(() => editProject(0), 500);
            } else {
                editProject(0);
            }
        }

        function deleteProject(index) {
            log(`üóëÔ∏è Suppression du projet ${index}`);
            projects.splice(index, 1);
            renderProjects();
        }

        function checkLocalStorage() {
            log('üíæ V√©rification du localStorage');
            const keys = Object.keys(localStorage);
            log(`Cl√©s trouv√©es: ${keys.join(', ')}`);
            
            keys.forEach(key => {
                if (key.includes('project') || key.includes('participant')) {
                    const value = localStorage.getItem(key);
                    log(`${key}: ${value.substring(0, 100)}...`);
                }
            });
        }

        function clearLogs() {
            document.getElementById('logOutput').textContent = 'Logs effac√©s...\n';
        }

        // Auto-start
        window.addEventListener('load', function() {
            log('üöÄ Debug tool loaded');
            log('üìç Admin Panel URL: http://localhost:8536/participants');
            log('üîß Pr√™t pour les tests de diagnostic');
        });
    </script>
</body>
</html>
