<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Fix Backend - MATC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .button {
            background: #4F46E5;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
            display: block;
            width: 100%;
        }
        .button:hover { background: #3730A3; }
        .button.success { background: #059669; }
        .button.danger { background: #dc2626; }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        
        .step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: left;
            border-left: 4px solid #4F46E5;
        }
        
        .step h3 {
            margin-top: 0;
            color: #4F46E5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Quick Fix Backend</h1>
        <p>Solution rapide pour le probl√®me "Backend non disponible"</p>

        <button class="button" onclick="checkBackend()">1. V√©rifier Backend</button>
        <button class="button success" onclick="showStartInstructions()">2. D√©marrer Backend</button>
        <button class="button" onclick="testAfterStart()">3. Test Apr√®s D√©marrage</button>

        <div id="results"></div>
        
        <div id="instructions" style="display: none;">
            <div class="step">
                <h3>üîß Comment d√©marrer le Backend:</h3>
                <ol>
                    <li><strong>Ouvrir Terminal/PowerShell</strong></li>
                    <li><strong>Naviguer vers le dossier:</strong><br>
                        <code>cd "C:\Users\ahmed\Desktop\MATC SITE\backend"</code>
                    </li>
                    <li><strong>D√©marrer le serveur:</strong><br>
                        <code>npm start</code>
                    </li>
                    <li><strong>Attendre le message:</strong><br>
                        "Server running on port 3001"
                    </li>
                </ol>
            </div>
            
            <div class="step">
                <h3>‚ö° Alternative rapide:</h3>
                <p>Double-cliquez sur le fichier <strong>start-backend.bat</strong> dans le dossier principal</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';

        function updateStatus(message, type = 'success') {
            const resultsDiv = document.getElementById('results');
            let statusClass = type;
            resultsDiv.innerHTML += `<div class="status ${statusClass}">${message}</div>`;
        }

        async function checkBackend() {
            updateStatus('üîç V√©rification du Backend...');
            
            try {
                const response = await fetch(`${API_BASE}/partnerships`);
                const data = await response.json();
                
                if (data.success) {
                    updateStatus(`‚úÖ Backend fonctionne! ${data.count} partnerships trouv√©es`);
                    updateStatus('üéâ Probl√®me r√©solu - vous pouvez maintenant sauvegarder', 'success');
                } else {
                    updateStatus('‚ùå Backend r√©pond mais avec erreur', 'error');
                }
            } catch (error) {
                updateStatus('‚ùå Backend non accessible', 'error');
                updateStatus('üí° Le Backend doit √™tre d√©marr√©', 'warning');
                updateStatus('üëá Cliquez sur "D√©marrer Backend" ci-dessous', 'warning');
            }
        }

        function showStartInstructions() {
            document.getElementById('instructions').style.display = 'block';
            updateStatus('üìã Instructions affich√©es ci-dessous', 'warning');
            updateStatus('‚è≥ Apr√®s avoir d√©marr√© le Backend, cliquez sur "Test Apr√®s D√©marrage"', 'warning');
        }

        async function testAfterStart() {
            updateStatus('üß™ Test apr√®s d√©marrage...');
            
            // Wait a bit for backend to start
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            try {
                const response = await fetch(`${API_BASE}/partnerships`);
                const data = await response.json();
                
                if (data.success) {
                    updateStatus('üéâ Parfait! Backend fonctionne maintenant', 'success');
                    updateStatus('‚úÖ Vous pouvez retourner √† l\'Admin Panel et sauvegarder', 'success');
                    
                    // Test freelance specifically
                    await testFreelanceSave();
                } else {
                    updateStatus('‚ö†Ô∏è Backend r√©pond mais avec probl√®me', 'warning');
                }
            } catch (error) {
                updateStatus('‚ùå Backend toujours non accessible', 'error');
                updateStatus('üîÑ V√©rifiez que le Backend est bien d√©marr√©', 'warning');
            }
        }

        async function testFreelanceSave() {
            updateStatus('üíæ Test sauvegarde Freelance...');
            
            const testData = {
                type: 'freelance',
                title: 'Test Freelance',
                subtitle: 'Test subtitle',
                intro: 'Test introduction',
                icon: 'üíª',
                color: 'green',
                gradient: 'from-green-500 to-green-600',
                details: ['Test detail'],
                requirements: ['Test requirement'],
                ctaLabel: 'Test CTA'
            };

            try {
                const response = await fetch(`${API_BASE}/partnerships/freelance`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });

                if (response.ok) {
                    updateStatus('‚úÖ Freelance sauvegarde fonctionne!', 'success');
                } else {
                    updateStatus(`‚ùå Freelance sauvegarde √©choue: ${response.status}`, 'error');
                }
            } catch (error) {
                updateStatus(`‚ùå Erreur test Freelance: ${error.message}`, 'error');
            }
        }

        // Auto-check on load
        window.onload = function() {
            updateStatus('üöÄ Quick Fix Backend charg√©');
            checkBackend();
        };
    </script>
</body>
</html>
