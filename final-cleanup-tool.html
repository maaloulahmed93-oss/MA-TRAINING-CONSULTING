<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .error { background: #fee; border-color: #fcc; color: #c33; }
        .success { background: #efe; border-color: #cfc; color: #363; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        .info { background: #e3f2fd; border-color: #bbdefb; color: #0d47a1; }
        .danger { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        button { padding: 12px 24px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .btn-primary { background: #007bff; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background: #f5f5f5; font-weight: bold; }
        .partner-card { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 6px; background: #fafafa; }
        .type-participant { border-left: 4px solid #dc3545; background: #fff5f5; }
        .mock-data { border-left: 4px solid #ffc107; background: #fffbf0; }
        .progress-bar { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .progress-fill { height: 100%; background: #dc3545; transition: width 0.3s ease; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ù…Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h1>
        
        <div class="section success">
            <h3>âœ… Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù†ÙØ°Ø©:</h3>
            <ul>
                <li>âœ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ <code>participantData.ts</code></li>
                <li>âœ… ØªØ¹Ø·ÙŠÙ„ Auto-Seeding ÙÙŠ <code>ParticipantsPage.tsx</code></li>
                <li>âœ… ØªØ¹Ø·ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ <code>mockParticipants.ts</code></li>
                <li>âœ… Ø¥Ù†Ø´Ø§Ø¡ Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</li>
            </ul>
        </div>

        <div class="section danger">
            <h3>ğŸ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆÙØ©:</h3>
            <div class="mock-data">
                <h4>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø­Ø°ÙÙ‡Ø§:</h4>
                <ul>
                    <li><strong>PART-2024-001</strong> - Ahmed Benali (ahmed.benali@email.com)</li>
                    <li><strong>PART-2024-002</strong> - Fatima El Mansouri (fatima.elmansouri@email.com)</li>
                    <li><strong>PART-2024-003</strong> - Youssef Trabelsi (youssef.trabelsi@example.com)</li>
                    <li><strong>PART-2024-004</strong> - Amina Sassi (amina.sassi@email.com)</li>
                    <li><strong>PART-2024-005</strong> - Youssef Khelifi (youssef.khelifi@email.com)</li>
                    <li><strong>PART-2024-006</strong> - Leila Bouazizi (leila.bouazizi@email.com)</li>
                    <li><strong>PART-834809</strong> - aziz ben ameur (ameur@gmail.com)</li>
                    <li><strong>FRE-340255</strong> - ismail (ismail@gmail.com)</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ:</h3>
            <button class="btn-primary" onclick="scanAllSystems()">
                <span id="scanIcon">ğŸ”</span> ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…
            </button>
            <button class="btn-danger" onclick="deleteAllMockData()" id="deleteBtn" disabled>
                <span id="deleteIcon">ğŸ—‘ï¸</span> Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            </button>
            <button class="btn-success" onclick="verifyCleanup()">
                <span id="verifyIcon">âœ…</span> Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø¸ÙŠÙ
            </button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let mockDataFound = [];
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `section ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function setButtonLoading(buttonId, loading) {
            const btn = document.getElementById(buttonId);
            if (btn) {
                btn.disabled = loading;
                const icon = btn.querySelector('span');
                if (loading) {
                    icon.innerHTML = '<div class="loading"></div>';
                } else {
                    if (buttonId === 'scanIcon') icon.innerHTML = 'ğŸ”';
                    else if (buttonId === 'deleteIcon') icon.innerHTML = 'ğŸ—‘ï¸';
                    else if (buttonId === 'verifyIcon') icon.innerHTML = 'âœ…';
                }
            }
        }

        async function scanAllSystems() {
            log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            try {
                // ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const response = await fetch(`${API_BASE}/partners`);
                const data = await response.json();
                
                if (data.success) {
                    const partners = data.data;
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    const mockEmails = [
                        'ahmed.benali@email.com', 'fatima.elmansouri@email.com', 
                        'youssef.trabelsi@example.com', 'fatima.gharbi@email.com',
                        'mohamed.triki@email.com', 'amina.sassi@email.com',
                        'youssef.khelifi@email.com', 'leila.bouazizi@email.com',
                        'ameur@gmail.com', 'ismail@gmail.com'
                    ];
                    
                    const mockPartnerIds = [
                        'PART-2024-001', 'PART-2024-002', 'PART-2024-003',
                        'PART-2024-004', 'PART-2024-005', 'PART-2024-006',
                        'PART-814809', 'PART-834809', 'FRE-340255'
                    ];
                    
                    mockDataFound = partners.filter(p => 
                        mockEmails.includes(p.email) ||
                        mockPartnerIds.includes(p.partnerId) ||
                        p.email.includes('@example.com') ||
                        p.email.includes('@email.com') ||
                        p.type === 'participant'
                    );
                    
                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    let resultsHtml = '<h4>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ:</h4>';
                    resultsHtml += `<p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡:</strong> ${partners.length}</p>`;
                    resultsHtml += `<p><strong>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</strong> ${mockDataFound.length}</p>`;
                    
                    if (mockDataFound.length > 0) {
                        resultsHtml += '<h4>ğŸ” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©:</h4>';
                        mockDataFound.forEach((partner, index) => {
                            resultsHtml += `
                                <div class="partner-card type-participant">
                                    <strong>${index + 1}. ${partner.partnerId}</strong> - ${partner.fullName}<br>
                                    <small>ğŸ“§ ${partner.email} | Ø§Ù„Ù†ÙˆØ¹: ${partner.type}</small><br>
                                    <small>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(partner.createdAt).toLocaleDateString('ar')}</small>
                                </div>
                            `;
                        });
                        
                        resultsHtml += '<div class="danger"><strong>âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø­Ø°Ù!</strong></div>';
                        document.getElementById('deleteBtn').disabled = false;
                    } else {
                        resultsHtml += '<div class="success"><strong>âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</strong></div>';
                    }
                    
                    log(resultsHtml, mockDataFound.length > 0 ? 'warning' : 'success');
                } else {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ API: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        async function deleteAllMockData() {
            if (mockDataFound.length === 0) {
                log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø­Ø°Ù', 'error');
                return;
            }
            
            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${mockDataFound.length} Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!`;
            if (!confirm(confirmMessage)) {
                return;
            }
            
            const doubleConfirm = prompt('Ø§ÙƒØªØ¨ "DELETE ALL" Ø¨Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù„Ù„ØªØ£ÙƒÙŠØ¯:');
            if (doubleConfirm !== 'DELETE ALL') {
                log('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù', 'warning');
                return;
            }
            
            log('ğŸ—‘ï¸ Ø¨Ø¯Ø¡ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'warning');
            
            // Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ
            for (let i = 5; i > 0; i--) {
                log(`<div style="font-size: 18px; font-weight: bold; color: #dc3545;">â³ Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ø°Ù Ø®Ù„Ø§Ù„ ${i} Ø«ÙˆØ§Ù†Ù...</div>`, 'warning');
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            try {
                let successCount = 0;
                let errorCount = 0;
                const total = mockDataFound.length;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                let progressHtml = `
                    <h4>ğŸ”„ Ø­Ø°Ù ${total} Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div id="progressText">0 / ${total}</div>
                `;
                log(progressHtml, 'info');
                
                // Ø­Ø°Ù ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                for (let i = 0; i < mockDataFound.length; i++) {
                    const partner = mockDataFound[i];
                    
                    try {
                        const response = await fetch(`${API_BASE}/partners/${partner.partnerId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            successCount++;
                            log(`âœ… ØªÙ… Ø­Ø°Ù ${partner.partnerId} (${partner.fullName})`, 'success');
                        } else {
                            errorCount++;
                            const errorData = await response.json();
                            log(`âŒ ÙØ´Ù„ Ø­Ø°Ù ${partner.partnerId}: ${errorData.message || response.statusText}`, 'error');
                        }
                    } catch (error) {
                        errorCount++;
                        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù ${partner.partnerId}: ${error.message}`, 'error');
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                    const progress = ((i + 1) / total) * 100;
                    const progressFill = document.getElementById('progressFill');
                    const progressText = document.getElementById('progressText');
                    if (progressFill) progressFill.style.width = `${progress}%`;
                    if (progressText) progressText.textContent = `${i + 1} / ${total}`;
                    
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                if (successCount > 0) {
                    log(`ğŸ‰ ØªÙ… Ø­Ø°Ù ${successCount} Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                }
                if (errorCount > 0) {
                    log(`âš ï¸ ÙØ´Ù„ Ø­Ø°Ù ${errorCount} Ø¨ÙŠØ§Ù†Ø§Øª`, 'warning');
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…
                log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
                await new Promise(resolve => setTimeout(resolve, 1000));
                await scanAllSystems();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø°Ù: ${error.message}`, 'error');
            } finally {
                mockDataFound = [];
                document.getElementById('deleteBtn').disabled = true;
            }
        }

        async function verifyCleanup() {
            log('âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¸Ø§ÙØ© Ø§Ù„Ù†Ø¸Ø§Ù…...', 'info');
            
            try {
                // ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const response = await fetch(`${API_BASE}/partners`);
                const data = await response.json();
                
                if (data.success) {
                    const partners = data.data;
                    
                    // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
                    const typeStats = {};
                    partners.forEach(partner => {
                        typeStats[partner.type] = (typeStats[partner.type] || 0) + 1;
                    });
                    
                    let verifyHtml = '<h4>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</h4>';
                    verifyHtml += '<table><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th></tr>';
                    
                    Object.entries(typeStats).forEach(([type, count]) => {
                        const isParticipant = type === 'participant';
                        verifyHtml += `<tr ${isParticipant ? 'style="background: #fff5f5; color: #dc3545;"' : ''}><td>${type}</td><td>${count}</td></tr>`;
                    });
                    
                    verifyHtml += '</table>';
                    
                    const hasParticipants = typeStats['participant'] > 0;
                    const expectedTypes = ['formateur', 'freelancer', 'commercial', 'entreprise'];
                    const hasOnlyValidTypes = Object.keys(typeStats).every(type => expectedTypes.includes(type));
                    
                    if (hasParticipants) {
                        verifyHtml += '<div class="error"><strong>âŒ Ù„Ø§ ÙŠØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ø´Ø±ÙƒØ§Ø¡ Ù…Ù† Ù†ÙˆØ¹ "participant"!</strong></div>';
                    } else if (hasOnlyValidTypes) {
                        verifyHtml += '<div class="success"><strong>ğŸ‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø¸ÙŠÙ! ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµØ­ÙŠØ­Ø© ÙÙ‚Ø· (4 Ø£Ù†ÙˆØ§Ø¹)</strong></div>';
                    } else {
                        verifyHtml += '<div class="warning"><strong>âš ï¸ Ù‚Ø¯ ÙŠÙˆØ¬Ø¯ Ø£Ù†ÙˆØ§Ø¹ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©</strong></div>';
                    }
                    
                    log(verifyHtml, hasParticipants ? 'error' : (hasOnlyValidTypes ? 'success' : 'warning'));
                } else {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚: ${error.message}`, 'error');
            }
        }

        // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            log('ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø´Ø§Ù…Ù„', 'info');
            log('Ø§Ø¶ØºØ· "ÙØ­Øµ Ø´Ø§Ù…Ù„ Ù„Ù„Ù†Ø¸Ø§Ù…" Ù„Ù„Ø¨Ø¯Ø¡', 'info');
        };
    </script>
</body>
</html>
